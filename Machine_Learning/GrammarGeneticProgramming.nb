(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[         0,          0]
NotebookDataLength[    178906,       4154]
NotebookOptionsPosition[    171971,       4018]
NotebookOutlinePosition[    172305,       4033]
CellTagsIndexPosition[    172262,       4030]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Grammar-based genetic programming", "Title",
 CellChangeTimes->{{3.790378058447762*^9, 
  3.790378064008601*^9}},ExpressionUUID->"231a28b8-24e8-4850-bed2-\
97e28e2feb38"],

Cell[CellGroupData[{

Cell["Grammar definition and parsing", "Section",
 CellChangeTimes->{{3.7903780755573807`*^9, 
  3.790378079944899*^9}},ExpressionUUID->"082e424d-3c6e-4a29-ab66-\
8f49caa9d4f7"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GrammarPrettifyRule", "[", "rule_", "]"}], ":=", 
   RowBox[{
    RowBox[{"Style", "[", 
     RowBox[{
      RowBox[{"rule", "[", "\"\<From\>\"", "]"}], ",", "Bold"}], "]"}], "->", 
    
    RowBox[{"ReplaceAll", "[", 
     RowBox[{
      RowBox[{"rule", "[", "\"\<To\>\"", "]"}], ",", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"NonTerm", "[", "arg_", "]"}], "\[RuleDelayed]", 
         RowBox[{"Style", "[", 
          RowBox[{"arg", ",", "Bold"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"Term", "[", "arg_", "]"}], "\[RuleDelayed]", 
         RowBox[{"Style", "[", 
          RowBox[{"arg", ",", "Italic"}], "]"}]}]}], "}"}]}], "]"}]}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GrammarPrettify", "[", "grammar_", "]"}], ":=", 
   RowBox[{"Column", "[", 
    RowBox[{"Map", "[", 
     RowBox[{"GrammarPrettifyRule", ",", "grammar"}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"grammar", " ", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<cond\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Term", "[", "\"\<logicOp\>\"", "]"}], ",", 
          RowBox[{"NonTerm", "[", "\"\<cond\>\"", "]"}], ",", 
          RowBox[{"NonTerm", "[", "\"\<cond\>\"", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{
         RowBox[{
          RowBox[{"Term", "[", "\"\<logicOp\>\"", "]"}], "[", "\"\<Value\>\"",
           "]"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NonTerm", "[", "\"\<cond\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"NonTerm", "[", "\"\<cond\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}]}], "]"}]}]}], "|>"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<cond\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Term", "[", "\"\<not\>\"", "]"}], ",", 
          RowBox[{"NonTerm", "[", "\"\<cond\>\"", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{"Not", "[", 
         RowBox[{
          RowBox[{"NonTerm", "[", "\"\<cond\>\"", "]"}], "[", "\"\<Value\>\"",
           "]"}], "]"}]}]}], "|>"}], ",", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<cond\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Term", "[", "\"\<numOp\>\"", "]"}], ",", 
          RowBox[{"NonTerm", "[", "\"\<numQuant\>\"", "]"}], ",", 
          RowBox[{"NonTerm", "[", "\"\<numQuant\>\"", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{
         RowBox[{
          RowBox[{"Term", "[", "\"\<numOp\>\"", "]"}], "[", "\"\<Value\>\"", 
          "]"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"NonTerm", "[", "\"\<numQuant\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"NonTerm", "[", "\"\<numQuant\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}]}], "]"}]}]}], "|>"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<numQuant\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Term", "[", "\"\<factor\>\"", "]"}], ",", 
          RowBox[{"NonTerm", "[", "\"\<expression\>\"", "]"}]}], "}"}]}], ",",
        "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{"Times", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Term", "[", "\"\<factor\>\"", "]"}], "[", "\"\<Value\>\"",
            "]"}], ",", 
          RowBox[{
           RowBox[{"NonTerm", "[", "\"\<expression\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}]}], "]"}]}]}], "|>"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<numQuant\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"NonTerm", "[", "\"\<expression\>\"", "]"}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{
         RowBox[{"NonTerm", "[", "\"\<expression\>\"", "]"}], "[", 
         "\"\<Value\>\"", "]"}]}]}], "|>"}], ",", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<expression\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Term", "[", "\"\<techInd\>\"", "]"}], ",", 
          RowBox[{"Term", "[", "\"\<observable\>\"", "]"}], ",", 
          RowBox[{"Term", "[", "\"\<window\>\"", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{
         RowBox[{
          RowBox[{"Term", "[", "\"\<techInd\>\"", "]"}], "[", "\"\<Value\>\"",
           "]"}], "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Term", "[", "\"\<observable\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"Term", "[", "\"\<window\>\"", "]"}], "[", "\"\<Value\>\"",
            "]"}]}], "]"}]}]}], "|>"}], ",", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<expression\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Term", "[", "\"\<lag\>\"", "]"}], ",", 
          RowBox[{"Term", "[", "\"\<observable\>\"", "]"}]}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{"Prev", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Term", "[", "\"\<observable\>\"", "]"}], "[", 
           "\"\<Value\>\"", "]"}], ",", 
          RowBox[{
           RowBox[{"Term", "[", "\"\<lag\>\"", "]"}], "[", "\"\<Value\>\"", 
           "]"}]}], "]"}]}]}], "|>"}], ",", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<From\>\"", "\[Rule]", "\"\<expression\>\""}], ",", 
       RowBox[{"\"\<To\>\"", "\[Rule]", 
        RowBox[{"{", 
         RowBox[{"Term", "[", "\"\<observable\>\"", "]"}], "}"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"\"\<Value\>\"", "\[Rule]", 
        RowBox[{
         RowBox[{"Term", "[", "\"\<observable\>\"", "]"}], "[", 
         "\"\<Value\>\"", "]"}]}]}], "|>"}]}], "\[IndentingNewLine]", "}"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"terminalSet", " ", "=", " ", 
   RowBox[{"{", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"Term", "[", 
      RowBox[{"\"\<logicOp\>\"", ",", "\"\<And\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<logicOp\>\"", ",", "\"\<Or\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<logicOp\>\"", ",", "\"\<Xor\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<numOp\>\"", ",", "\"\<Greater\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<numOp\>\"", ",", "\"\<GreaterEqual\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<numOp\>\"", ",", "\"\<Less\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<numOp\>\"", ",", "\"\<LessEqual\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<observable\>\"", ",", "\"\<Open\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<observable\>\"", ",", "\"\<Low\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<observable\>\"", ",", "\"\<High\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<observable\>\"", ",", "\"\<Close\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<lag\>\"", ",", "\"\<1\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<lag\>\"", ",", "\"\<2\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<lag\>\"", ",", "\"\<3\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<lag\>\"", ",", "\"\<4\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<lag\>\"", ",", "\"\<5\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<window\>\"", ",", "\"\<10\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<window\>\"", ",", "\"\<20\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<window\>\"", ",", "\"\<30\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<window\>\"", ",", "\"\<40\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<window\>\"", ",", "\"\<50\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<factor\>\"", ",", "\"\<0.7\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<factor\>\"", ",", "\"\<0.9\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<factor\>\"", ",", "\"\<1.1\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<factor\>\"", ",", "\"\<1.3\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<techInd\>\"", ",", "\"\<SMA\>\""}], "]"}], ",", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<techInd\>\"", ",", "\"\<EMA\>\""}], "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Term", "[", 
      RowBox[{"\"\<not\>\"", ",", "\"\<Not\>\""}], "]"}]}], 
    "\[IndentingNewLine]", "}"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.790342676060285*^9, 3.7903426885314093`*^9}, {
   3.790343698923114*^9, 3.790343748806674*^9}, {3.7903438021747093`*^9, 
   3.790343817320533*^9}, {3.790343854406949*^9, 3.790343877049046*^9}, {
   3.7903439287357388`*^9, 3.7903440809966803`*^9}, {3.7903441689180727`*^9, 
   3.790344178864008*^9}, {3.790344228535228*^9, 3.7903442378968363`*^9}, {
   3.7903442692084713`*^9, 3.7903443140245523`*^9}, {3.7903443545003633`*^9, 
   3.790344439466031*^9}, {3.7903444715377493`*^9, 3.790344488158393*^9}, 
   3.7903445540805817`*^9, {3.790347791009404*^9, 3.7903478714993563`*^9}, {
   3.790348397816537*^9, 3.790348440027976*^9}, {3.790459453943384*^9, 
   3.790459454497119*^9}, {3.790468466938444*^9, 3.7904686138366833`*^9}, {
   3.790468671244553*^9, 3.790468739000846*^9}, {3.7904687718900633`*^9, 
   3.790468773607869*^9}, {3.790468880751397*^9, 3.79046890211629*^9}, {
   3.790469360080749*^9, 3.790469454683938*^9}, {3.7905448494803953`*^9, 
   3.790544865764814*^9}, {3.790545342207829*^9, 3.790545348589766*^9}},
 CellLabel->
  "In[126]:=",ExpressionUUID->"2596c319-046c-4a6c-a461-990c8cd0bff1"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"GrammarPrettify", "[", "grammar", "]"}]], "Input",
 CellChangeTimes->{3.7904594634186697`*^9},
 CellLabel->
  "In[185]:=",ExpressionUUID->"effdc811-5ed1-4747-a52b-de866aec4d5c"],

Cell[BoxData[
 TagBox[GridBox[{
    {
     RowBox[{
      StyleBox["\<\"cond\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        StyleBox["\<\"logicOp\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"cond\"\>",
         StripOnInput->False,
         FontWeight->Bold], ",", 
        StyleBox["\<\"cond\"\>",
         StripOnInput->False,
         FontWeight->Bold]}], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"cond\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        StyleBox["\<\"not\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"cond\"\>",
         StripOnInput->False,
         FontWeight->Bold]}], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"cond\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        StyleBox["\<\"numOp\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"numQuant\"\>",
         StripOnInput->False,
         FontWeight->Bold], ",", 
        StyleBox["\<\"numQuant\"\>",
         StripOnInput->False,
         FontWeight->Bold]}], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"numQuant\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        StyleBox["\<\"factor\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"expression\"\>",
         StripOnInput->False,
         FontWeight->Bold]}], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"numQuant\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       StyleBox["\<\"expression\"\>",
        StripOnInput->False,
        FontWeight->Bold], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"expression\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        StyleBox["\<\"techInd\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"observable\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"window\"\>",
         StripOnInput->False,
         FontSlant->Italic]}], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"expression\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       RowBox[{
        StyleBox["\<\"lag\"\>",
         StripOnInput->False,
         FontSlant->Italic], ",", 
        StyleBox["\<\"observable\"\>",
         StripOnInput->False,
         FontSlant->Italic]}], "}"}]}]},
    {
     RowBox[{
      StyleBox["\<\"expression\"\>",
       StripOnInput->False,
       FontWeight->Bold], "\[Rule]", 
      RowBox[{"{", 
       StyleBox["\<\"observable\"\>",
        StripOnInput->False,
        FontSlant->Italic], "}"}]}]}
   },
   DefaultBaseStyle->"Column",
   GridBoxAlignment->{"Columns" -> {{Left}}},
   GridBoxItemSize->{"Columns" -> {{Automatic}}, "Rows" -> {{Automatic}}}],
  "Column"]], "Output",
 CellChangeTimes->{3.790459463729195*^9, 3.7904706638105707`*^9},
 CellLabel->
  "Out[185]=",ExpressionUUID->"e39b8d9b-d591-4ff2-9df0-992f6f1ae4b5"]
}, Open  ]],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"GrammarGraph", "[", "grammar_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"graphData", ",", "allSymbols", ",", "colorStyle"}], "}"}], ",",
      "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"graphData", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Map", "[", 
          RowBox[{"Thread", ",", 
           RowBox[{"Map", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"NonTerm", "[", 
                 RowBox[{"#", "[", "\"\<From\>\"", "]"}], "]"}], "\[Rule]", 
                RowBox[{"#", "[", "\"\<To\>\"", "]"}]}], ")"}], "&"}], ",", 
             "grammar"}], "]"}]}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"allSymbols", " ", "=", " ", 
       RowBox[{"DeleteDuplicates", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"NonTerm", "[", 
               RowBox[{"#", "[", "\"\<From\>\"", "]"}], "]"}], ",", 
              RowBox[{"#", "[", "\"\<To\>\"", "]"}]}], "}"}], "&"}], ",", 
           "grammar"}], "]"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"colorStyle", " ", "=", " ", 
       RowBox[{"Join", "[", 
        RowBox[{
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"allSymbols", ",", "_NonTerm"}], "]"}], "\[Rule]", 
           "Blue"}], "]"}], ",", 
         RowBox[{"Thread", "[", 
          RowBox[{
           RowBox[{"Cases", "[", 
            RowBox[{"allSymbols", ",", "_Term"}], "]"}], "\[Rule]", "Red"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Graph", "[", 
       RowBox[{"graphData", ",", 
        RowBox[{"VertexLabels", "\[Rule]", "\"\<Name\>\""}], ",", 
        RowBox[{"VertexStyle", "\[Rule]", "colorStyle"}], ",", 
        RowBox[{"ImageSize", "\[Rule]", "800"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7904595790269337`*^9, 3.7904595793402443`*^9}},
 CellLabel->"In[5]:=",ExpressionUUID->"dbcee70f-0ecd-408e-9a7c-2a6b3a243902"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"GrammarGraph", "[", "grammar", "]"}]], "Input",
 CellChangeTimes->{3.790459593834159*^9},
 CellLabel->
  "In[280]:=",ExpressionUUID->"407eac81-0c5d-4ce8-a328-cbba96d15565"],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{
       $CellContext`NonTerm["cond"], 
       $CellContext`Term["logicOp"], 
       $CellContext`Term["not"], 
       $CellContext`Term["numOp"], 
       $CellContext`NonTerm["numQuant"], 
       $CellContext`Term["factor"], 
       $CellContext`NonTerm["expression"], 
       $CellContext`Term["techInd"], 
       $CellContext`Term["observable"], 
       $CellContext`Term["lag"]}, {{{1, 2}, {1, 1}, {1, 3}, {1, 4}, {1, 5}, {
       5, 6}, {5, 7}, {7, 8}, {7, 9}, {7, 10}}, Null}, {
      ImageSize -> 800, VertexLabels -> {"Name"}, 
       VertexStyle -> {$CellContext`Term["factor"] -> 
         RGBColor[1, 0, 0], $CellContext`NonTerm["expression"] -> 
         RGBColor[0, 0, 1], $CellContext`NonTerm["numQuant"] -> 
         RGBColor[0, 0, 1], $CellContext`Term["observable"] -> 
         RGBColor[1, 0, 0], $CellContext`Term["techInd"] -> 
         RGBColor[1, 0, 0], $CellContext`Term["not"] -> 
         RGBColor[1, 0, 0], $CellContext`NonTerm["cond"] -> 
         RGBColor[0, 0, 1], $CellContext`Term["logicOp"] -> 
         RGBColor[1, 0, 0], $CellContext`Term["numOp"] -> 
         RGBColor[1, 0, 0], $CellContext`Term["lag"] -> 
         RGBColor[1, 0, 0]}}]]}, 
    TagBox[GraphicsGroupBox[{
       {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
        ArrowBox[{{0., 3.}, {-1., 2.}}, 0.03700564971751412], 
        ArrowBox[{{0., 3.}, {0., 2.}}, 0.03700564971751412], 
        ArrowBox[{{0., 3.}, {1., 2.}}, 0.03700564971751412], 
        ArrowBox[{{0., 3.}, {2., 2.}}, 0.03700564971751412], 
        ArrowBox[BezierCurveBox[{{0., 3.}, {-0.2863681171350719, 
         3.080294279021607}, {-0.4101469105751911, 
         3.34514363295201}, {-0.3566538340963171, 3.5360234393818075`}, {
         0.1688460408244838, 3.621300329502731}, {0.2799555238063517, 
         3.457131841279949}, {0.24628136934128025`, 3.166731391376878}, {0., 
         3.}},
         SplineDegree->7], 0.03700564971751412], 
        ArrowBox[{{2., 2.}, {1., 1.}}, 0.03700564971751412], 
        ArrowBox[{{2., 2.}, {2., 1.}}, 0.03700564971751412], 
        ArrowBox[{{2., 1.}, {1., 0.}}, 0.03700564971751412], 
        ArrowBox[{{2., 1.}, {2., 0.}}, 0.03700564971751412], 
        ArrowBox[{{2., 1.}, {3., 0.}}, 0.03700564971751412]}, 
       {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[0.7]}], {
         {RGBColor[0, 0, 1], DiskBox[{0., 3.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"NonTerm", "(", "\<\"cond\"\>", ")"}], 
          Offset[{2, 2}, {0.03700564971751412, 3.037005649717514}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{-1., 2.}, 0.03700564971751412]}, 
         InsetBox[
          RowBox[{"Term", "(", "\<\"logicOp\"\>", ")"}], 
          Offset[{2, 2}, {-0.9629943502824859, 2.037005649717514}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{0., 2.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"Term", "(", "\<\"not\"\>", ")"}], 
          Offset[{2, 2}, {0.03700564971751412, 2.037005649717514}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{1., 2.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"Term", "(", "\<\"numOp\"\>", ")"}], 
          Offset[{2, 2}, {1.0370056497175142, 2.037005649717514}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[0, 0, 1], DiskBox[{2., 2.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"NonTerm", "(", "\<\"numQuant\"\>", ")"}], 
          Offset[{2, 2}, {2.037005649717514, 2.037005649717514}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{1., 1.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"Term", "(", "\<\"factor\"\>", ")"}], 
          Offset[{2, 2}, {1.0370056497175142, 1.0370056497175142}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[0, 0, 1], DiskBox[{2., 1.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"NonTerm", "(", "\<\"expression\"\>", ")"}], 
          Offset[{2, 2}, {2.037005649717514, 1.0370056497175142}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{1., 0.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"Term", "(", "\<\"techInd\"\>", ")"}], 
          Offset[{2, 2}, {1.0370056497175142, 0.03700564971751412}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{2., 0.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"Term", "(", "\<\"observable\"\>", ")"}], 
          Offset[{2, 2}, {2.037005649717514, 0.03700564971751412}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         {RGBColor[1, 0, 0], DiskBox[{3., 0.}, 0.03700564971751412]}, InsetBox[
          RowBox[{"Term", "(", "\<\"lag\"\>", ")"}], 
          Offset[{2, 2}, {3.037005649717514, 0.03700564971751412}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}}}],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None,
  ImageSize->{548., Automatic}]], "Output",
 CellChangeTimes->{3.790459594187018*^9},
 CellLabel->
  "Out[280]=",ExpressionUUID->"a30814f3-ec89-4bc8-a2d6-a1df53b63b0c"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetComponents", "[", 
    RowBox[{"expr_", "/;", 
     RowBox[{
      RowBox[{"Depth", "[", "expr", "]"}], "<", "3"}]}], "]"}], ":=", 
   RowBox[{"{", "expr", "}"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GetComponents", "[", 
    RowBox[{"expr_", "/;", 
     RowBox[{
      RowBox[{"Depth", "[", "expr", "]"}], "\[Equal]", "3"}]}], "]"}], ":=", 
   RowBox[{"Prepend", "[", 
    RowBox[{
     RowBox[{"Level", "[", 
      RowBox[{"expr", ",", 
       RowBox[{"{", "1", "}"}]}], "]"}], ",", 
     RowBox[{"Head", "[", "expr", "]"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ExprFromComponents", "[", 
    RowBox[{"components_", " ", "/;", 
     RowBox[{
      RowBox[{"Length", "[", "components", "]"}], "\[LessEqual]", "1"}]}], 
    "]"}], ":=", 
   RowBox[{"First", "[", "components", "]"}]}], ";"}], "\[IndentingNewLine]", 

 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ExprFromComponents", "[", 
     RowBox[{"components_", " ", "/;", 
      RowBox[{
       RowBox[{"Length", "[", "components", "]"}], ">", "1"}]}], "]"}], ":=", 
    
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"head", ",", "rest"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"head", ",", "rest"}], "}"}], " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"First", "[", "components", "]"}], ",", 
          RowBox[{"Rest", "[", "components", "]"}]}], "}"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Apply", "[", 
        RowBox[{"head", ",", "rest"}], "]"}]}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"Synthesize", "[", 
     RowBox[{"exprComponents_", ",", "synthValues_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"positions", ",", "lastPos", ",", 
        RowBox[{"tmpSynthValues", " ", "=", " ", "synthValues"}], ",", 
        RowBox[{"tmpExprComponents", " ", "=", " ", "exprComponents"}]}], 
       "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Do", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{"positions", " ", "=", " ", 
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"tmpSynthValues", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", 
             RowBox[{"tmpExprComponents", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"positions", "\[NotEqual]", " ", 
             RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"lastPos", " ", "=", " ", 
              RowBox[{"First", "@", 
               RowBox[{"Last", "@", "positions"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{"tmpExprComponents", "[", 
               RowBox[{"[", "i", "]"}], "]"}], " ", "=", " ", 
              RowBox[{"Replace", "[", 
               RowBox[{
                RowBox[{"tmpExprComponents", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"Part", "[", 
                 RowBox[{"tmpSynthValues", ",", "lastPos"}], "]"}]}], "]"}]}],
              ";", "\[IndentingNewLine]", 
             RowBox[{"tmpSynthValues", " ", "=", " ", 
              RowBox[{"Delete", "[", 
               RowBox[{"tmpSynthValues", ",", "lastPos"}], "]"}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "1", ",", 
           RowBox[{"Length", "[", "tmpExprComponents", "]"}]}], "}"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ExprFromComponents", "@", "tmpExprComponents"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"MatchPositions", "[", 
    RowBox[{"expr_", ",", "synthesizations_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"pos", ",", "newSynth", ",", "recursive"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"pos", " ", "=", " ", 
       RowBox[{"FirstPosition", "[", 
        RowBox[{"synthesizations", ",", 
         RowBox[{"First", "[", "expr", "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"pos", " ", "=!=", 
         RowBox[{"Missing", "[", "\"\<NotFound\>\"", "]"}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"newSynth", " ", "=", " ", 
         RowBox[{"ReplacePart", "[", 
          RowBox[{"synthesizations", ",", 
           RowBox[{
            RowBox[{"First", "[", "pos", "]"}], "\[Rule]", "Found"}]}], 
          "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"newSynth", " ", "=", " ", "synthesizations"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"pos", " ", "=", " ", 
          RowBox[{"{", "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"recursive", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Rest", "[", "expr", "]"}], "\[NotEqual]", 
          RowBox[{"{", "}"}]}], ",", 
         RowBox[{"MatchPositions", "[", 
          RowBox[{
           RowBox[{"Rest", "[", "expr", "]"}], ",", "newSynth"}], "]"}], ",", 
         
         RowBox[{"{", "}"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Transpose", "@", 
       RowBox[{"{", 
        RowBox[{"Flatten", "@", 
         RowBox[{"Join", "[", 
          RowBox[{"pos", ",", "recursive"}], "]"}]}], "}"}]}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.79035714595779*^9, 3.7903572493874207`*^9}, {
  3.7903572801192503`*^9, 3.790357312880403*^9}, {3.790359091130979*^9, 
  3.790359092294668*^9}, {3.790360996664217*^9, 3.790361054211101*^9}, {
  3.790361116761746*^9, 3.790361118356138*^9}, {3.7903615802666683`*^9, 
  3.790361587082275*^9}, {3.79036173894415*^9, 3.790361750751802*^9}, {
  3.790361949004196*^9, 3.790361949243352*^9}, {3.790455525533889*^9, 
  3.790455527163363*^9}, {3.790455610599532*^9, 3.790455610874358*^9}, {
  3.7904571522889023`*^9, 3.790457184725666*^9}, {3.790457275631034*^9, 
  3.790457292503612*^9}, {3.790457331959938*^9, 3.7904573508431883`*^9}, {
  3.790458457881886*^9, 3.7904585876572237`*^9}, {3.790458635325519*^9, 
  3.790458638150556*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"48a50991-ced2-49a9-8324-4b430a7ed712"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"GetValue", "[", 
    RowBox[{"treeSymbol_", ",", "grammar_"}], "]"}], ":=", 
   RowBox[{"ReplaceAll", "[", 
    RowBox[{"treeSymbol", ",", 
     RowBox[{
      RowBox[{"NonTerm", "[", 
       RowBox[{"_", ",", "rule_"}], "]"}], "\[RuleDelayed]", 
      RowBox[{
       RowBox[{"grammar", "[", 
        RowBox[{"[", "rule", "]"}], "]"}], "[", "\"\<Value\>\"", "]"}]}]}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"SynthesizeNonTerm", "[", 
     RowBox[{"treeSymbol_", ",", "grammar_", ",", "synthesizations_"}], "]"}],
     ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "val", ",", "eval", ",", "matchPos", ",", "newSynth", ",", 
        "newSynthLabel"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"val", " ", "=", " ", 
        RowBox[{"GetValue", "[", 
         RowBox[{"treeSymbol", ",", "grammar"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"matchPos", " ", "=", " ", 
        RowBox[{"MatchPositions", "[", 
         RowBox[{
          RowBox[{"GetComponents", "[", "val", "]"}], ",", 
          RowBox[{"synthesizations", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"eval", " ", "=", " ", 
        RowBox[{"Synthesize", "[", 
         RowBox[{
          RowBox[{"GetComponents", "[", "val", "]"}], ",", 
          RowBox[{"Extract", "[", 
           RowBox[{"synthesizations", ",", "matchPos"}], "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"newSynth", " ", "=", " ", 
        RowBox[{"Delete", "[", 
         RowBox[{"synthesizations", ",", "matchPos"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"newSynthLabel", " ", "=", " ", 
        RowBox[{"ReplaceAll", "[", 
         RowBox[{"treeSymbol", ",", 
          RowBox[{
           RowBox[{"NonTerm", "[", 
            RowBox[{"x_", ",", "_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"NonTerm", "[", "x", "]"}], "[", "\"\<Value\>\"", 
            "]"}]}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Prepend", "[", 
        RowBox[{"newSynth", ",", 
         RowBox[{"newSynthLabel", "\[Rule]", "eval"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"SynthesizeTerm", "[", 
    RowBox[{"treeSymbol_", ",", "synthesizations_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"eval", ",", "new"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Label", " ", "the", " ", "value", " ", "of", " ", "a", " ", 
       "Terminal"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Length", "[", "treeSymbol", "]"}], "\[Equal]", "2"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Prepend", "[", 
        RowBox[{"synthesizations", ",", " ", 
         RowBox[{"ReplaceAll", "[", 
          RowBox[{"treeSymbol", ",", 
           RowBox[{
            RowBox[{"Term", "[", 
             RowBox[{"termName_", ",", "value_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"Term", "[", "termName", "]"}], "[", "\"\<Value\>\"", 
               "]"}], "\[Rule]", "value"}], ")"}]}]}], "]"}]}], "]"}], ",", 
       "\[IndentingNewLine]", "synthesizations"}], "\[IndentingNewLine]", 
      "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.7608259159282923`*^9, 3.7608261293502274`*^9}, {
   3.760993804648603*^9, 3.760993818856369*^9}, {3.760993962206794*^9, 
   3.760993964499547*^9}, {3.762464072031178*^9, 3.762464112064948*^9}, {
   3.7624643045761833`*^9, 3.762464390148593*^9}, 3.762464423827539*^9, {
   3.7624644673167963`*^9, 3.762464468165412*^9}, 3.762465283151471*^9, 
   3.764024512651712*^9, {3.7640248091439734`*^9, 3.7640248341747427`*^9}, {
   3.7640250122955647`*^9, 3.764025024633459*^9}, {3.790345193352819*^9, 
   3.7903452035879908`*^9}, {3.7903458981323557`*^9, 3.790345901525694*^9}, 
   3.790346083565462*^9, {3.790346123580125*^9, 3.7903461305744133`*^9}, {
   3.790346319902143*^9, 3.790346385673501*^9}, {3.790349639650073*^9, 
   3.7903496495171623`*^9}, {3.7903497153306837`*^9, 3.790349727390431*^9}, {
   3.7903770273002872`*^9, 3.7903770296095753`*^9}, {3.790377086666507*^9, 
   3.790377145004786*^9}, {3.790377183424777*^9, 3.790377241196746*^9}, {
   3.79037728699023*^9, 3.790377287556652*^9}, {3.790377836058153*^9, 
   3.7903778436886177`*^9}, {3.79037853144715*^9, 3.790378531604763*^9}, {
   3.7904552735877943`*^9, 3.790455312297996*^9}, {3.790456171067285*^9, 
   3.790456181776188*^9}},
 CellLabel->"In[12]:=",ExpressionUUID->"eb1b2b68-d657-4bb4-87c4-41912d2b4be6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"SynthesizeTree", "[", 
    RowBox[{"graph_", ",", "labels_", ",", "grammar_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "depthFirstScan", ",", "labeledDFS", ",", "symbolType", ",", 
       "synthesized"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", " ", 
      RowBox[{
      "Walk", " ", "the", " ", "parse", " ", "tree", " ", "in", " ", "post", 
       " ", "order"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"depthFirstScan", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"Last", "@", 
         RowBox[{"Reap", "[", "\[IndentingNewLine]", 
          RowBox[{"DepthFirstScan", "[", 
           RowBox[{"graph", ",", "1", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<PostvisitVertex\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Sow", "[", "#", "]"}], "&"}], ")"}]}], "}"}]}], 
           "]"}], "\[IndentingNewLine]", "]"}]}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"labeledDFS", " ", "=", " ", 
       RowBox[{"depthFirstScan", " ", "/.", "labels"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", " ", 
       RowBox[{
       "Synthesize", " ", "in", " ", "the", " ", "order", " ", "of", " ", 
        "the", " ", "depthfirstscan"}], " ", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"synthesized", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"symbolType", " ", "=", " ", 
          RowBox[{"Head", "[", "s", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"symbolType", " ", "===", " ", "Term"}], ",", 
           RowBox[{"synthesized", " ", "=", " ", 
            RowBox[{"SynthesizeTerm", "[", 
             RowBox[{"s", ",", "synthesized"}], "]"}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{"symbolType", " ", "===", " ", "NonTerm"}], ",", 
           RowBox[{"synthesized", " ", "=", " ", 
            RowBox[{"SynthesizeNonTerm", "[", 
             RowBox[{"s", ",", "grammar", ",", "synthesized"}], "]"}]}]}], 
          "]"}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"s", ",", "labeledDFS"}], "}"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ToExpression", "@", 
       RowBox[{"ToString", "@", 
        RowBox[{"Return", "[", 
         RowBox[{"synthesized", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}], "]"}]}]}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.760995468114646*^9, 3.760995495791847*^9}, {
   3.760995528748373*^9, 3.760995627884274*^9}, {3.760995678576338*^9, 
   3.7609957528479137`*^9}, {3.7609961296955547`*^9, 3.760996184585101*^9}, {
   3.7609962173561907`*^9, 3.76099627244386*^9}, {3.7609963440388603`*^9, 
   3.760996423791665*^9}, {3.7609964833759823`*^9, 3.7609965628952827`*^9}, {
   3.760996801168336*^9, 3.7609968020762367`*^9}, 3.760998078283998*^9, {
   3.7609981212385883`*^9, 3.7609981257699842`*^9}, 3.762464311752103*^9, {
   3.762464438154924*^9, 3.762464499620295*^9}, 3.7625262555643873`*^9, {
   3.7628108543121157`*^9, 3.762810855319008*^9}, {3.764025051879121*^9, 
   3.764025098640737*^9}, {3.7651312839477363`*^9, 3.765131285832206*^9}, {
   3.790345006521284*^9, 3.790345074070271*^9}, 3.790345845713934*^9, {
   3.790377343156938*^9, 3.790377354040244*^9}, {3.790377384282391*^9, 
   3.790377384537279*^9}, 3.790377441844515*^9, 3.790377540663052*^9, {
   3.7903778601090393`*^9, 3.7903778742483053`*^9}, 3.7904534889048843`*^9},
 CellLabel->"In[15]:=",ExpressionUUID->"7ab65703-bb69-4f34-8664-807662f2a19e"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"edgeList1", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[DirectedEdge]", "2"}], ",", 
     RowBox[{"1", "\[DirectedEdge]", "3"}], ",", 
     RowBox[{"1", "\[DirectedEdge]", "4"}], ",", 
     RowBox[{"3", "\[DirectedEdge]", "5"}], ",", 
     RowBox[{"3", "\[DirectedEdge]", "6"}], ",", 
     RowBox[{"3", "\[DirectedEdge]", "7"}], ",", 
     RowBox[{"6", "\[DirectedEdge]", "8"}], ",", 
     RowBox[{"8", "\[DirectedEdge]", "9"}], ",", 
     RowBox[{"7", "\[DirectedEdge]", "10"}], ",", 
     RowBox[{"10", "\[DirectedEdge]", "11"}], ",", 
     RowBox[{"10", "\[DirectedEdge]", "12"}], ",", 
     RowBox[{"4", "\[DirectedEdge]", "13"}], ",", 
     RowBox[{"4", "\[DirectedEdge]", "14"}], ",", 
     RowBox[{"4", "\[DirectedEdge]", "15"}], ",", 
     RowBox[{"14", "\[DirectedEdge]", "16"}], ",", 
     RowBox[{"16", "\[DirectedEdge]", "17"}], ",", 
     RowBox[{"15", "\[DirectedEdge]", "18"}], ",", 
     RowBox[{"18", "\[DirectedEdge]", "19"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"labels1", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<cond\>\"", ",", "1"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<logicOp\>\"", ",", "\"\<And\>\""}], "]"}]}], ",", 
     RowBox[{"3", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<cond\>\"", ",", "3"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<cond\>\"", ",", "3"}], "]"}]}], ",", 
     RowBox[{"5", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<numOp\>\"", ",", "\"\<Greater\>\""}], "]"}]}], " ", ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], " ", ",", 
     RowBox[{"7", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], " ", ",", 
     RowBox[{"8", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "8"}], "]"}]}], " ", ",", 
     RowBox[{"9", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<High\>\""}], "]"}]}], " ", ",", 
     RowBox[{"10", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "7"}], "]"}]}], " ", ",", 
     RowBox[{"11", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<lag\>\"", ",", "\"\<3\>\""}], "]"}]}], " ", ",", 
     RowBox[{"12", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<Low\>\""}], "]"}]}], " ", ",", 
     
     RowBox[{"13", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<numOp\>\"", ",", "\"\<Less\>\""}], "]"}]}], " ", ",", 
     RowBox[{"14", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], " ", ",", 
     RowBox[{"15", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], " ", ",", 
     RowBox[{"16", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "8"}], "]"}]}], " ", ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<Open\>\""}], "]"}]}], " ", ",", 
     RowBox[{"18", "\[Rule]", " ", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "8"}], "]"}]}], ",", 
     RowBox[{"19", "\[Rule]", " ", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<Close\>\""}], "]"}]}]}], 
    "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7901993475777073`*^9, 3.790199779879158*^9}, {
  3.7903422096006947`*^9, 3.790342304231863*^9}, {3.7903429601616507`*^9, 
  3.7903429816246862`*^9}, {3.79034301364384*^9, 3.7903431496103077`*^9}, {
  3.7903435938111753`*^9, 3.790343620937538*^9}, {3.7903436558304567`*^9, 
  3.790343674848072*^9}, {3.790345089338812*^9, 3.790345089652974*^9}, {
  3.790453021331588*^9, 3.79045302244851*^9}},
 CellLabel->
  "In[137]:=",ExpressionUUID->"d422a228-1249-4f3c-9929-cb45137abfd3"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"g1", " ", "=", " ", 
  RowBox[{"Graph", "[", 
   RowBox[{"edgeList1", ",", 
    RowBox[{"VertexLabels", "\[Rule]", "labels1"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.79019978223025*^9, 3.790199790412916*^9}, {
  3.790199853689146*^9, 3.79019985428449*^9}, {3.7904530253598127`*^9, 
  3.790453037157456*^9}},
 CellLabel->
  "In[139]:=",ExpressionUUID->"1398a73c-95e3-40e9-bd35-e307cdab8d23"],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 
      19}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {3, 6}, {3, 7}, {6, 8}, {8, 9}, {
       7, 10}, {10, 11}, {10, 12}, {4, 13}, {4, 14}, {4, 15}, {14, 16}, {16, 
       17}, {15, 18}, {18, 19}}, Null}, {
      VertexLabels -> {
        6 -> $CellContext`NonTerm["numQuant", 5], 
         18 -> $CellContext`NonTerm["expression", 8], 
         3 -> $CellContext`NonTerm["cond", 3], 
         11 -> $CellContext`Term["lag", "3"], 
         5 -> $CellContext`Term["numOp", "Greater"], 
         8 -> $CellContext`NonTerm["expression", 8], 
         7 -> $CellContext`NonTerm["numQuant", 5], 
         14 -> $CellContext`NonTerm["numQuant", 5], 
         10 -> $CellContext`NonTerm["expression", 7], 
         9 -> $CellContext`Term["observable", "High"], 
         4 -> $CellContext`NonTerm["cond", 3], 
         17 -> $CellContext`Term["observable", "Open"], 
         16 -> $CellContext`NonTerm["expression", 8], 
         12 -> $CellContext`Term["observable", "Low"], 
         13 -> $CellContext`Term["numOp", "Less"], 
         2 -> $CellContext`Term["logicOp", "And"], 
         15 -> $CellContext`NonTerm["numQuant", 5], 
         1 -> $CellContext`NonTerm["cond", 1], 
         19 -> $CellContext`Term["observable", "Close"]}}]]}, 
    TagBox[GraphicsGroupBox[{
       {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
        ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGAQAmImKJYRjEs6ufy3/SPp1i9vPNkdIPRx+1dXkrcXljM6
oMvfSlpmmCHzFqd83H7RyVrGXA4weXT1DFAAUf/dHl0eIv7cHpf8bTD/L1we
3b60ii+h6xNYHHDJw/i45HWapV9cYhKAy6O7B8Z/AKXR3QPjP0DR9xyDDwsH
7Oq/45RHD0dc/oGpR/cPjA+TR1cP48PMR1cP48PkATCkB9M=
         "], 
         0.03702325155936649]}, 
       {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
        0.7]}], {
         DiskBox[{1.7284635393598995, 2.9110964873429888}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], 
          Offset[{2, 2}, {1.765486790919266, 2.9481197389023555}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.1819435304589368, 2.183322365507242}, 
          0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"logicOp\"\>", ",", "\<\"And\"\>"}], ")"}], 
          Offset[{2, 2}, {0.21896678201830327, 2.2203456170666085}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.9097176522946839, 2.183322365507242}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
          Offset[{2, 2}, {0.9467409038540504, 2.2203456170666085}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 2.183322365507242}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 2.2203456170666085}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0., 1.4555482436714944}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"numOp\"\>", ",", "\<\"Greater\"\>"}], ")"}], 
          Offset[{2, 2}, {0.03702325155936649, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7277741218357472, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {0.7647973733951137, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.819435304589368, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {1.8564585561487346, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7277741218357472, 0.727774121835747}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {0.7647973733951137, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7277741218357472, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
          Offset[{2, 2}, {0.7647973733951137, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.819435304589368, 0.727774121835747}, 0.03702325155936649],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
          Offset[{2, 2}, {1.8564585561487346, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.4555482436714944, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"lag\"\>", ",", "\<\"3\"\>"}], ")"}], 
          Offset[{2, 2}, {1.4925714952308609, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.183322365507242, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Low\"\>"}], ")"}], 
          Offset[{2, 2}, {2.2203456170666085, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.5472094264251153, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
          Offset[{2, 2}, {2.584232677984482, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.00275767009661, 1.4555482436714944}, 0.03702325155936649],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {4.039780921655977, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 0.727774121835747}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.00275767009661, 0.727774121835747}, 0.03702325155936649], 
         InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {4.039780921655977, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.00275767009661, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
          Offset[{2, 2}, {4.039780921655977, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}}}],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None,
  ImageSize->{769., Automatic}]], "Output",
 CellChangeTimes->{
  3.790199790815337*^9, 3.790199854454792*^9, 3.790342306694368*^9, 
   3.7903436770750093`*^9, 3.790345090843131*^9, 3.790346797834442*^9, 
   3.7903568987576447`*^9, 3.790378124993442*^9, 3.790378548560257*^9, {
   3.7904530294656563`*^9, 3.7904530380411673`*^9}, 3.790453781171205*^9, 
   3.7904663690741777`*^9, 3.7904694837781477`*^9},
 CellLabel->
  "Out[139]=",ExpressionUUID->"02f03ab0-2c6d-4af0-af08-a1264c6c3284"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"SynthesizeTree", "[", 
   RowBox[{"g1", ",", "labels1", ",", "grammar"}], "]"}], " ", "//", " ", 
  "FullForm"}]], "Input",
 CellChangeTimes->{{3.790453468105657*^9, 3.790453497303897*^9}},
 CellLabel->
  "In[140]:=",ExpressionUUID->"32448206-7dfc-4813-9eed-06133cc5405a"],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"And", "[", 
    RowBox[{
     RowBox[{"Greater", "[", 
      RowBox[{"High", ",", 
       RowBox[{"Prev", "[", 
        RowBox[{"Low", ",", "3"}], "]"}]}], "]"}], ",", 
     RowBox[{"Less", "[", 
      RowBox[{"Open", ",", "Close"}], "]"}]}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellChangeTimes->{
  3.790453398514769*^9, {3.790453470202586*^9, 3.790453497519857*^9}, {
   3.790455279016727*^9, 3.790455307294629*^9}, 3.790455532084416*^9, 
   3.7904558159932137`*^9, {3.79045617588008*^9, 3.790456187275242*^9}, 
   3.790457195190936*^9, 3.790457359186005*^9, 3.790458653856529*^9, 
   3.790469486097183*^9},
 CellLabel->
  "Out[140]//FullForm=",ExpressionUUID->"a642a942-e8cd-4e4a-b0fb-\
b73e76872ceb"]
}, Open  ]],

Cell[BoxData[{
 RowBox[{
  RowBox[{"edgeList2", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[DirectedEdge]", "2"}], ",", 
     RowBox[{"1", "\[DirectedEdge]", "3"}], ",", 
     RowBox[{"1", "\[DirectedEdge]", "4"}], ",", 
     RowBox[{"3", "\[DirectedEdge]", "5"}], ",", 
     RowBox[{"3", "\[DirectedEdge]", "6"}], ",", 
     RowBox[{"3", "\[DirectedEdge]", "7"}], ",", 
     RowBox[{"6", "\[DirectedEdge]", "8"}], ",", 
     RowBox[{"6", "\[DirectedEdge]", "9"}], ",", 
     RowBox[{"9", "\[DirectedEdge]", "10"}], ",", 
     RowBox[{"9", "\[DirectedEdge]", "11"}], ",", 
     RowBox[{"9", "\[DirectedEdge]", "12"}], ",", 
     RowBox[{"7", "\[DirectedEdge]", "13"}], ",", 
     RowBox[{"13", "\[DirectedEdge]", "14"}], ",", 
     RowBox[{"13", "\[DirectedEdge]", "15"}], ",", 
     RowBox[{"13", "\[DirectedEdge]", "16"}], ",", 
     RowBox[{"4", "\[DirectedEdge]", "17"}], ",", 
     RowBox[{"4", "\[DirectedEdge]", "18"}], ",", 
     RowBox[{"4", "\[DirectedEdge]", "19"}], ",", 
     RowBox[{"18", "\[DirectedEdge]", "20"}], ",", 
     RowBox[{"20", "\[DirectedEdge]", "21"}], ",", 
     RowBox[{"20", "\[DirectedEdge]", "22"}], ",", 
     RowBox[{"19", "\[DirectedEdge]", "23"}], ",", 
     RowBox[{"23", "\[DirectedEdge]", "24"}]}], "}"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"labels2", " ", "=", " ", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<cond\>\"", ",", "1"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<logicOp\>\"", ",", "\"\<Or\>\""}], "]"}]}], ",", 
     RowBox[{"3", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<cond\>\"", ",", "3"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<cond\>\"", ",", "3"}], "]"}]}], ",", 
     RowBox[{"5", "\[Rule]", " ", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<numOp\>\"", ",", "\"\<Less\>\""}], "]"}]}], ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "4"}], "]"}]}], " ", ",", 
     RowBox[{"7", "\[Rule]", " ", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], ",", 
     RowBox[{"8", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<factor\>\"", ",", "\"\<1.05\>\""}], "]"}]}], " ", ",", 
     RowBox[{"9", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "6"}], "]"}]}], " ", ",", 
     RowBox[{"10", "\[Rule]", " ", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<techInd\>\"", ",", "\"\<SMA\>\""}], "]"}]}], ",", 
     RowBox[{"11", "\[Rule]", " ", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<Close\>\""}], "]"}]}], ",", 
     RowBox[{"12", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<window\>\"", ",", "\"\<20\>\""}], "]"}]}], " ", ",", 
     RowBox[{"13", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "6"}], "]"}]}], " ", ",", 
     RowBox[{"14", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<techInd\>\"", ",", "\"\<SMA\>\""}], "]"}]}], " ", ",", 
     RowBox[{"15", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<Close\>\""}], "]"}]}], " ", 
     ",", 
     RowBox[{"16", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<window\>\"", ",", "\"\<40\>\""}], "]"}]}], " ", ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<numOp\>\"", ",", "\"\<Less\>\""}], "]"}]}], " ", ",", 
     RowBox[{"18", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], " ", ",", 
     RowBox[{"19", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<numQuant\>\"", ",", "5"}], "]"}]}], " ", ",", 
     RowBox[{"20", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "7"}], "]"}]}], ",", 
     RowBox[{"21", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<lag\>\"", ",", "\"\<2\>\""}], "]"}]}], ",", 
     RowBox[{"22", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<Close\>\""}], "]"}]}], ",", 
     RowBox[{"23", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\"\<expression\>\"", ",", "8"}], "]"}]}], ",", 
     RowBox[{"24", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\"\<observable\>\"", ",", "\"\<High\>\""}], "]"}]}]}], 
    "}"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7904530498962917`*^9, 3.790453050048305*^9}, {
  3.790453091828443*^9, 3.7904533618387403`*^9}, {3.790453531558099*^9, 
  3.790453716100666*^9}, {3.7904688458883944`*^9, 3.7904688524746523`*^9}, {
  3.790469329652884*^9, 3.790469351099359*^9}, {3.790469493024211*^9, 
  3.790469498056683*^9}},
 CellLabel->
  "In[141]:=",ExpressionUUID->"b4317d5f-dfa0-4326-a688-fb99011c98a0"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"g2", " ", "=", " ", 
  RowBox[{"Graph", "[", 
   RowBox[{"edgeList2", ",", 
    RowBox[{"VertexLabels", "\[Rule]", "labels2"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7904537241298733`*^9, 3.7904537256421022`*^9}, {
  3.790453776718771*^9, 3.790453776866914*^9}},
 CellLabel->
  "In[143]:=",ExpressionUUID->"6921fcbe-378e-4bd9-9c4c-cdbbf2a392dc"],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19,
       20, 21, 22, 23, 
      24}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {3, 6}, {3, 7}, {6, 8}, {6, 9}, {
       9, 10}, {9, 11}, {9, 12}, {7, 13}, {13, 14}, {13, 15}, {13, 16}, {4, 
       17}, {4, 18}, {4, 19}, {18, 20}, {20, 21}, {20, 22}, {19, 23}, {23, 
       24}}, Null}, {
      VertexLabels -> {
        6 -> $CellContext`NonTerm["numQuant", 4], 
         21 -> $CellContext`Term["lag", "2"], 
         18 -> $CellContext`NonTerm["numQuant", 5], 
         23 -> $CellContext`NonTerm["expression", 8], 
         24 -> $CellContext`Term["observable", "High"], 
         22 -> $CellContext`Term["observable", "Close"], 
         3 -> $CellContext`NonTerm["cond", 3], 
         20 -> $CellContext`NonTerm["expression", 7], 
         11 -> $CellContext`Term["observable", "Close"], 
         5 -> $CellContext`Term["numOp", "Less"], 
         8 -> $CellContext`Term["factor", "1.05"], 
         7 -> $CellContext`NonTerm["numQuant", 5], 
         14 -> $CellContext`Term["techInd", "SMA"], 
         10 -> $CellContext`Term["techInd", "SMA"], 
         9 -> $CellContext`NonTerm["expression", 6], 
         4 -> $CellContext`NonTerm["cond", 3], 
         17 -> $CellContext`Term["numOp", "Less"], 
         16 -> $CellContext`Term["window", "40"], 
         12 -> $CellContext`Term["window", "20"], 
         13 -> $CellContext`NonTerm["expression", 6], 
         2 -> $CellContext`Term["logicOp", "Or"], 
         15 -> $CellContext`Term["observable", "Close"], 
         1 -> $CellContext`NonTerm["cond", 1], 
         19 -> $CellContext`NonTerm["numQuant", 5]}}]]}, 
    TagBox[GraphicsGroupBox[{
       {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[0.02143628275493949], 
        ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGAQB2ImKD5wT35tnx2LQ+WSw6WbeZkdpveaBCtcfG6/rWyp
Qe+UP/bo8hySNU8y87/ilOf13bkoy0XQASaPrp4BCiDqP2PIQ8Qf2+OSh/BZ
HWDy6PZtBdM8OOVf6nOz/10tgFMe4h8RuDy6eyD0ZfsqFHGEPMT+N3B5dPfC
+DB5dPUw82HhhC4P4+OSh8Tfd7g8un2vwP5ncMAlD+PjkldjenvwmhEXXB49
PGF8mHr08ITxYfLo6l1ex853/saHYT5M3jAr3e7GHUG4PLp5MD5MHgD0NTcD

         "], 0.0433963923053807]}, 
       {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
        0.7]}], {
         DiskBox[{2.530545570883845, 2.3816899490671486}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], 
          Offset[{2, 2}, {2.5739419631892257, 2.425086341372529}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7442781090834839, 1.7862674618003616}, 
          0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"logicOp\"\>", ",", "\<\"Or\"\>"}], ")"}], 
          Offset[{2, 2}, {0.7876745013888646, 1.8296638541057422}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.339700596350271, 1.7862674618003616}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
          Offset[{2, 2}, {1.3830969886556517, 1.8296638541057422}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.316813032684206, 1.7862674618003616}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
          Offset[{2, 2}, {4.360209424989587, 1.8296638541057422}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0., 1.1908449745335743}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
          Offset[{2, 2}, {0.0433963923053807, 1.234241366838955}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.5954224872667871, 1.1908449745335743}, 
          0.0433963923053807], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "4"}], ")"}], 
          Offset[{2, 2}, {0.6388188795721679, 1.234241366838955}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.679401192700542, 1.1908449745335743}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {2.7227975850059227, 1.234241366838955}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.2977112436333936, 0.5954224872667873}, 
          0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"factor\"\>", ",", "\<\"1.05\"\>"}], ")"}], 
          Offset[{2, 2}, {0.34110763593877425, 0.638818879572168}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.8931337309001807, 0.5954224872667873}, 
          0.0433963923053807], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "6"}], ")"}], 
          Offset[{2, 2}, {0.9365301232055614, 0.638818879572168}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.2977112436333936, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"techInd\"\>", ",", "\<\"SMA\"\>"}], ")"}], 
          Offset[{2, 2}, {0.34110763593877425, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.8931337309001807, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
          Offset[{2, 2}, {0.9365301232055614, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.4885562181669678, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"window\"\>", ",", "\<\"20\"\>"}], ")"}], 
          Offset[{2, 2}, {1.5319526104723484, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.679401192700542, 0.5954224872667873}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "6"}], ")"}], Offset[{2, 2}, 
          {2.7227975850059227, 0.638818879572168}], ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.083978705433755, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"techInd\"\>", ",", "\<\"SMA\"\>"}], ")"}], 
          Offset[{2, 2}, {2.1273750977391357, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.679401192700542, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
          Offset[{2, 2}, {2.7227975850059227, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.274823679967329, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"window\"\>", ",", "\<\"40\"\>"}], ")"}], 
          Offset[{2, 2}, {3.3182200722727098, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.5725349236007227, 1.1908449745335743}, 
          0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
          Offset[{2, 2}, {3.6159313159061033, 1.234241366838955}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.167957410867509, 1.1908449745335743}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {4.21135380317289, 1.234241366838955}], ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{5.06109114176769, 1.1908449745335743}, 0.0433963923053807], 
         InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {5.104487534073071, 1.234241366838955}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.167957410867509, 0.5954224872667873}, 0.0433963923053807],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
          Offset[{2, 2}, {4.21135380317289, 0.638818879572168}], ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.870246167234116, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"lag\"\>", ",", "\<\"2\"\>"}], ")"}], 
          Offset[{2, 2}, {3.913642559539497, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.465668654500903, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
          Offset[{2, 2}, {4.509065046806284, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{5.06109114176769, 0.5954224872667873}, 0.0433963923053807], 
         InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {5.104487534073071, 0.638818879572168}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{5.06109114176769, 0.}, 0.0433963923053807], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
          Offset[{2, 2}, {5.104487534073071, 0.0433963923053807}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}}}],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None,
  ImageSize->{610., Automatic}]], "Output",
 CellChangeTimes->{3.790453726498917*^9, 3.790453778186742*^9, 
  3.7904663691549664`*^9, 3.790468855227729*^9, 3.790469521072893*^9},
 CellLabel->
  "Out[143]=",ExpressionUUID->"f0d87c59-723c-4b4f-b403-4a4c2bf7a89c"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"SynthesizeTree", "[", 
   RowBox[{"g2", ",", "labels2", ",", "grammar"}], "]"}], "//", " ", 
  "FullForm"}]], "Input",
 CellChangeTimes->{{3.7904537703546457`*^9, 3.790453790853676*^9}},
 CellLabel->
  "In[144]:=",ExpressionUUID->"888fe5d3-d03d-481c-9fb7-de8fab3b9e8a"],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"Or", "[", 
    RowBox[{
     RowBox[{"Less", "[", 
      RowBox[{
       RowBox[{"Times", "[", 
        RowBox[{"1.05`", ",", 
         RowBox[{"SMA", "[", 
          RowBox[{"Close", ",", "20"}], "]"}]}], "]"}], ",", 
       RowBox[{"SMA", "[", 
        RowBox[{"Close", ",", "40"}], "]"}]}], "]"}], ",", 
     RowBox[{"Less", "[", 
      RowBox[{
       RowBox[{"Prev", "[", 
        RowBox[{"Close", ",", "2"}], "]"}], ",", "High"}], "]"}]}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellChangeTimes->{{3.790453772584498*^9, 3.790453791569374*^9}, 
   3.790455540513533*^9, 3.7904586610835447`*^9, 3.7904688562861958`*^9, 
   3.790469522094696*^9},
 CellLabel->
  "Out[144]//FullForm=",ExpressionUUID->"66df493e-7ed9-41f0-8d00-\
f1468e8e8034"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Operations on trees", "Section",
 CellChangeTimes->{{3.790458933537712*^9, 
  3.7904589364573793`*^9}},ExpressionUUID->"b7490d6f-4c75-440d-9324-\
b62f58f03dc2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Subtree", "[", 
    RowBox[{"graph_", ",", "labels_", ",", "vertex_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"children", ",", "toDelete", ",", "subtree", ",", "sublabels"}],
       "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"children", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"Last", "@", 
         RowBox[{"Reap", "@", 
          RowBox[{"DepthFirstScan", "[", 
           RowBox[{"graph", ",", "vertex", ",", 
            RowBox[{"{", 
             RowBox[{"\"\<PrevisitVertex\>\"", "\[Rule]", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Sow", "[", "#", "]"}], "&"}], ")"}]}], "}"}]}], 
           "]"}]}]}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"toDelete", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", "graph", "]"}], ",", "children"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"subtree", " ", "=", " ", 
       RowBox[{"VertexDelete", "[", 
        RowBox[{"graph", ",", 
         RowBox[{"Complement", "[", 
          RowBox[{
           RowBox[{"VertexList", "[", "graph", "]"}], ",", "children"}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"sublabels", " ", "=", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{"labels", ",", 
         RowBox[{"x_", "/;", 
          RowBox[{"MemberQ", "[", 
           RowBox[{"children", ",", 
            RowBox[{"First", "[", "x", "]"}]}], "]"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"subtree", ",", "sublabels"}], "}"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"DeleteSubtree", "[", 
    RowBox[{"graph_", ",", "labels_", ",", "vertex_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "subtree", ",", "sublabels", ",", "subVertexes", ",", 
       "conectionRemoved", ",", "withoutSubtree", ",", "newLabels"}], "}"}], 
     ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"subtree", ",", "sublabels"}], "}"}], " ", "=", " ", 
       RowBox[{"Subtree", "[", 
        RowBox[{"graph", ",", " ", "labels", ",", " ", "vertex"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"subVertexes", " ", "=", " ", 
       RowBox[{"VertexList", "[", "subtree", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"conectionRemoved", " ", "=", " ", 
       RowBox[{"ReplaceAll", "[", 
        RowBox[{
         RowBox[{"EdgeList", "[", "graph", "]"}], ",", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"x_", "/;", 
              RowBox[{"!", 
               RowBox[{"MemberQ", "[", 
                RowBox[{"subVertexes", ",", "x"}], "]"}]}]}], ")"}], 
            "\[DirectedEdge]", 
            RowBox[{"(", 
             RowBox[{"y_", "/;", 
              RowBox[{"MemberQ", "[", 
               RowBox[{"subVertexes", ",", "y"}], "]"}]}], ")"}]}], ")"}], 
          "\[RuleDelayed]", 
          RowBox[{"x", "\[DirectedEdge]", "Empty"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"withoutSubtree", " ", "=", " ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"Intersection", "[", 
            RowBox[{
             RowBox[{"VertexList", "[", "conectionRemoved", "]"}], ",", 
             "subVertexes"}], "]"}], "]"}], "\[NotEqual]", " ", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"VertexDelete", "[", 
          RowBox[{"conectionRemoved", ",", "subVertexes"}], "]"}], ",", 
         "\[IndentingNewLine]", "conectionRemoved"}], "\[IndentingNewLine]", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"newLabels", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{"labels", ",", "sublabels"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Graph", "[", 
         RowBox[{"withoutSubtree", ",", 
          RowBox[{"VertexLabels", "\[Rule]", "newLabels"}]}], "]"}], ",", 
        "newLabels"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"InsertSubtree", "[", 
    RowBox[{"graph_", ",", "labels_", ",", "subtree_", ",", "sublabels_", ",", 
     RowBox[{"subtreeRoot_", " ", ":", " ", "1"}]}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "edges", ",", "missing", ",", "missingRules", ",", "newRules", ",", 
       "insertionRules", ",", "formattedSubtree", ",", "formattedSublabels", 
       ",", "formattedSubtreeRoot", ",", "newTree", ",", "newLabels"}], "}"}],
      ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"VertexList", "[", "graph", "]"}], ",", "Empty"}], "]"}]}],
         ",", 
        RowBox[{"Return", "[", "$Failed", "]"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"edges", " ", "=", " ", 
       RowBox[{"DeleteCases", "[", 
        RowBox[{
         RowBox[{"VertexList", "[", "graph", "]"}], ",", "Empty"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"missing", " ", "=", " ", 
       RowBox[{"Complement", "[", 
        RowBox[{
         RowBox[{"Range", "[", 
          RowBox[{"Max", "[", "edges", "]"}], "]"}], ",", "edges"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"missingRules", " ", "=", " ", 
       RowBox[{"Thread", "[", 
        RowBox[{
         RowBox[{"Take", "[", 
          RowBox[{
           RowBox[{"VertexList", "[", "subtree", "]"}], ",", 
           RowBox[{"UpTo", "[", 
            RowBox[{"Length", "[", "missing", "]"}], "]"}]}], "]"}], 
         "\[Rule]", 
         RowBox[{"Take", "[", 
          RowBox[{"missing", ",", 
           RowBox[{"UpTo", "[", 
            RowBox[{"Length", "[", 
             RowBox[{"VertexList", "[", "subtree", "]"}], "]"}], "]"}]}], 
          "]"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", 
           RowBox[{"VertexList", "[", "subtree", "]"}], "]"}], "-", 
          RowBox[{"Length", "[", "missing", "]"}]}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"newRules", " ", "=", " ", 
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Drop", "[", 
             RowBox[{
              RowBox[{"VertexList", "[", "subtree", "]"}], ",", 
              RowBox[{"Length", "[", "missing", "]"}]}], "]"}], "\[Rule]", 
            " ", 
            RowBox[{"Range", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Max", "[", "edges", "]"}], "+", "1"}], ",", 
              RowBox[{
               RowBox[{"Max", "[", "edges", "]"}], "+", 
               RowBox[{"Length", "[", 
                RowBox[{"VertexList", "[", "subtree", "]"}], "]"}], "-", 
               RowBox[{"Length", "[", "missing", "]"}]}]}], "]"}]}], "]"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"insertionRules", " ", "=", " ", 
          RowBox[{"Join", "[", 
           RowBox[{"missingRules", ",", "newRules"}], "]"}]}], ";"}], 
        "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"insertionRules", " ", "=", " ", "missingRules"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"formattedSubtree", " ", "=", " ", 
       RowBox[{
        RowBox[{"EdgeList", "[", "subtree", "]"}], "/.", "insertionRules"}]}],
       ";", "\[IndentingNewLine]", 
      RowBox[{"formattedSublabels", " ", "=", " ", 
       RowBox[{"MapAt", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"ReplaceAll", "[", 
           RowBox[{"#", ",", "insertionRules"}], "]"}], "&"}], ",", 
         "sublabels", ",", 
         RowBox[{"{", 
          RowBox[{"All", ",", "1"}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"formattedSubtreeRoot", " ", "=", " ", 
       RowBox[{"subtreeRoot", " ", "/.", "insertionRules"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newTree", " ", "=", " ", 
       RowBox[{"ReplaceAll", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{
           RowBox[{"EdgeList", "[", "graph", "]"}], ",", "formattedSubtree"}],
           "]"}], ",", 
         RowBox[{"Empty", "\[Rule]", "formattedSubtreeRoot"}]}], "]"}]}], ";",
       "\[IndentingNewLine]", 
      RowBox[{"newLabels", " ", "=", " ", 
       RowBox[{"SortBy", "[", 
        RowBox[{
         RowBox[{"Join", "[", 
          RowBox[{"labels", ",", "formattedSublabels"}], "]"}], ",", 
         "First"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Graph", "[", 
         RowBox[{"newTree", ",", 
          RowBox[{"VertexLabels", "\[Rule]", "newLabels"}]}], "]"}], ",", 
        "newLabels"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.789833090853594*^9, 3.789833192372734*^9}, {
   3.789833531339673*^9, 3.789833563524232*^9}, 3.789833696011055*^9, {
   3.78984744431467*^9, 3.789847704242251*^9}, {3.789847803295294*^9, 
   3.789847814332649*^9}, {3.789847861685192*^9, 3.78984789389155*^9}, {
   3.789848003773026*^9, 3.7898480389290047`*^9}, {3.789848493181694*^9, 
   3.789848527370165*^9}, {3.7898486179053717`*^9, 3.7898486463038*^9}, {
   3.789850376057413*^9, 3.7898504140537233`*^9}, {3.7898504454448557`*^9, 
   3.789850631132496*^9}, {3.789851177151168*^9, 3.7898511799271803`*^9}, {
   3.789851216292913*^9, 3.7898513409624767`*^9}, {3.7898615054602003`*^9, 
   3.789861530322874*^9}, 3.789861692683601*^9, 3.789862050514936*^9, {
   3.7899126928814163`*^9, 3.789912758057597*^9}, 3.7899302847502537`*^9, 
   3.789930354161729*^9, 3.790005536533122*^9, {3.790005661599536*^9, 
   3.790005688801499*^9}, {3.790459028422957*^9, 3.790459036259425*^9}, {
   3.790543746483783*^9, 3.790543770961753*^9}},
 CellLabel->"In[16]:=",ExpressionUUID->"f631ef19-1d41-4fd9-be26-8ef5eea1ab3f"],

Cell[CellGroupData[{

Cell[BoxData["g1"], "Input",
 CellChangeTimes->{{3.790459113689322*^9, 3.790459113935494*^9}},
 CellLabel->
  "In[266]:=",ExpressionUUID->"5d759315-b71a-4268-8979-a61ce94b5f9c"],

Cell[BoxData[
 GraphicsBox[
  NamespaceBox["NetworkGraphics",
   DynamicModuleBox[{Typeset`graph = HoldComplete[
     Graph[{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 
      19}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {3, 6}, {3, 7}, {6, 8}, {8, 9}, {
       7, 10}, {10, 11}, {10, 12}, {4, 13}, {4, 14}, {4, 15}, {14, 16}, {16, 
       17}, {15, 18}, {18, 19}}, Null}, {
      VertexLabels -> {
        6 -> $CellContext`NonTerm["numQuant", 5], 
         18 -> $CellContext`NonTerm["expression", 8], 
         3 -> $CellContext`NonTerm["cond", 3], 
         11 -> $CellContext`Term["lag", "3"], 
         5 -> $CellContext`Term["numOp", "Greater"], 
         8 -> $CellContext`NonTerm["expression", 8], 
         7 -> $CellContext`NonTerm["numQuant", 5], 
         14 -> $CellContext`NonTerm["numQuant", 5], 
         10 -> $CellContext`NonTerm["expression", 7], 
         9 -> $CellContext`Term["observable", "High"], 
         4 -> $CellContext`NonTerm["cond", 3], 
         17 -> $CellContext`Term["observable", "Open"], 
         16 -> $CellContext`NonTerm["expression", 8], 
         12 -> $CellContext`Term["observable", "Low"], 
         13 -> $CellContext`Term["numOp", "Less"], 
         2 -> $CellContext`Term["logicOp", "And"], 
         15 -> $CellContext`NonTerm["numQuant", 5], 
         1 -> $CellContext`NonTerm["cond", 1], 
         19 -> $CellContext`Term["observable", "Close"]}}]]}, 
    TagBox[GraphicsGroupBox[{
       {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
        ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGAQAmImKJYRjEs6ufy3/SPp1i9vPNkdIPRx+1dXkrcXljM6
oMvfSlpmmCHzFqd83H7RyVrGXA4weXT1DFAAUf/dHl0eIv7cHpf8bTD/L1we
3b60ii+h6xNYHHDJw/i45HWapV9cYhKAy6O7B8Z/AKXR3QPjP0DR9xyDDwsH
7Oq/45RHD0dc/oGpR/cPjA+TR1cP48PMR1cP48PkATCkB9M=
         "], 
         0.03702325155936649]}, 
       {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
        0.7]}], {
         DiskBox[{1.7284635393598995, 2.9110964873429888}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], 
          Offset[{2, 2}, {1.765486790919266, 2.9481197389023555}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.1819435304589368, 2.183322365507242}, 
          0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"logicOp\"\>", ",", "\<\"And\"\>"}], ")"}], 
          Offset[{2, 2}, {0.21896678201830327, 2.2203456170666085}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.9097176522946839, 2.183322365507242}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
          Offset[{2, 2}, {0.9467409038540504, 2.2203456170666085}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 2.183322365507242}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 2.2203456170666085}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0., 1.4555482436714944}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"numOp\"\>", ",", "\<\"Greater\"\>"}], ")"}], 
          Offset[{2, 2}, {0.03702325155936649, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7277741218357472, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {0.7647973733951137, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.819435304589368, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {1.8564585561487346, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7277741218357472, 0.727774121835747}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {0.7647973733951137, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{0.7277741218357472, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
          Offset[{2, 2}, {0.7647973733951137, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.819435304589368, 0.727774121835747}, 0.03702325155936649],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
          Offset[{2, 2}, {1.8564585561487346, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{1.4555482436714944, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"lag\"\>", ",", "\<\"3\"\>"}], ")"}], 
          Offset[{2, 2}, {1.4925714952308609, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.183322365507242, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Low\"\>"}], ")"}], 
          Offset[{2, 2}, {2.2203456170666085, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{2.5472094264251153, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
          Offset[{2, 2}, {2.584232677984482, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 1.4555482436714944}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.00275767009661, 1.4555482436714944}, 0.03702325155936649],
          InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
          Offset[{2, 2}, {4.039780921655977, 1.4925714952308609}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 0.727774121835747}, 
          0.03702325155936649], InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{3.2749835482608622, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], ")"}], 
          Offset[{2, 2}, {3.312006799820229, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.00275767009661, 0.727774121835747}, 0.03702325155936649], 
         InsetBox[
          RowBox[{"NonTerm", "(", 
           RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
          Offset[{2, 2}, {4.039780921655977, 0.7647973733951134}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}, {
         DiskBox[{4.00275767009661, 0.}, 0.03702325155936649], InsetBox[
          RowBox[{"Term", "(", 
           RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
          Offset[{2, 2}, {4.039780921655977, 0.03702325155936649}], 
          ImageScaled[{0, 0}],
          BaseStyle->"Graphics"]}}}],
     MouseAppearanceTag["NetworkGraphics"]],
    AllowKernelInitialization->False]],
  DefaultBaseStyle->{
   "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
  FormatType->TraditionalForm,
  FrameTicks->None,
  ImageSize->{519., Automatic}]], "Output",
 CellChangeTimes->{3.790459114295677*^9},
 CellLabel->
  "Out[266]=",ExpressionUUID->"754537b9-7461-4c38-a93f-6e86f7120fe0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"subtree1", " ", "=", " ", 
  RowBox[{"Subtree", "[", 
   RowBox[{"g1", ",", "labels1", ",", "4"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7904591818108273`*^9, 3.790459186174479*^9}},
 CellLabel->
  "In[268]:=",ExpressionUUID->"5e2c98fc-7eaa-4ff9-b894-346660be4288"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{4, 13, 14, 15, 16, 17, 18, 
        19}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {5, 6}, {4, 7}, {7, 8}}, 
         Null}, {VertexLabels -> {
          18 -> $CellContext`NonTerm["expression", 8], 
           14 -> $CellContext`NonTerm["numQuant", 5], 
           4 -> $CellContext`NonTerm["cond", 3], 
           17 -> $CellContext`Term["observable", "Open"], 
           16 -> $CellContext`NonTerm["expression", 8], 
           13 -> $CellContext`Term["numOp", "Less"], 
           15 -> $CellContext`NonTerm["numQuant", 5], 
           19 -> $CellContext`Term["observable", "Close"]}}]]}, 
      TagBox[GraphicsGroupBox[{
         {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
          ArrowBox[{{{0.8819171036881969, 2.6457513110645907`}, {0., 
           1.763834207376394}}, {{0.8819171036881969, 2.6457513110645907`}, {
           0.8819171036881969, 1.763834207376394}}, {{0.8819171036881969, 
           2.6457513110645907`}, {1.7638342073763937`, 1.763834207376394}}, {{
           0.8819171036881969, 1.763834207376394}, {0.8819171036881969, 
           0.881917103688197}}, {{1.7638342073763937`, 1.763834207376394}, {
           1.7638342073763937`, 0.881917103688197}}, {{0.8819171036881969, 
           0.881917103688197}, {0.8819171036881969, 0.}}, {{
           1.7638342073763937`, 0.881917103688197}, {1.7638342073763937`, 
           0.}}}, 0.027644045725436814`]}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
          0.7]}], {
           DiskBox[{0.8819171036881969, 2.6457513110645907}, 
            0.027644045725436814], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {0.9095611494136336, 2.6733953567900275}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 1.763834207376394}, 0.027644045725436814], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {0.027644045725436814, 1.7914782531018307}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.8819171036881969, 1.763834207376394}, 
            0.027644045725436814], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {0.9095611494136336, 1.7914782531018307}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.7638342073763937, 1.763834207376394}, 
            0.027644045725436814], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {1.7914782531018305, 1.7914782531018307}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.8819171036881969, 0.881917103688197}, 
            0.027644045725436814], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {0.9095611494136336, 0.9095611494136338}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.8819171036881969, 0.}, 0.027644045725436814], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], ")"}], 
            Offset[{2, 2}, {0.9095611494136336, 0.027644045725436814}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.7638342073763937, 0.881917103688197}, 
            0.027644045725436814], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {1.7914782531018305, 0.9095611494136338}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.7638342073763937, 0.}, 0.027644045725436814], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {1.7914782531018305, 0.027644045725436814}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}}}],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    
    FormatType->TraditionalForm,
    FrameTicks->None,
    ImageSize->{350., Automatic}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"13", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"14", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"15", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"16", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], "]"}]}], ",", 
     RowBox[{"18", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"19", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.790459111151917*^9, 3.790459186893664*^9},
 CellLabel->
  "Out[268]=",ExpressionUUID->"59736a14-0078-4d81-acf8-1fdcc2fd6ca0"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"cropped2", " ", "=", " ", 
  RowBox[{"DeleteSubtree", "[", 
   RowBox[{"g2", ",", "labels2", ",", "3"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.790459169822783*^9, 3.790459197022461*^9}},
 CellLabel->
  "In[269]:=",ExpressionUUID->"890deaf9-277f-4132-b2d7-551af28a4f02"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{
        1, 2, Empty, 4, 17, 18, 19, 20, 21, 22, 23, 24}, {{{1, 2}, {1, 3}, {1,
          4}, {4, 5}, {4, 6}, {4, 7}, {6, 8}, {8, 9}, {8, 10}, {7, 11}, {11, 
         12}}, Null}, {
        GraphLayout -> {"Dimension" -> 2}, 
         VertexLabels -> {
          21 -> $CellContext`Term["lag", 2], 
           18 -> $CellContext`NonTerm["numQuant", 5], 
           23 -> $CellContext`NonTerm["expression", 8], 
           24 -> $CellContext`Term["observable", "High"], 
           22 -> $CellContext`Term["observable", "Close"], 
           20 -> $CellContext`NonTerm["expression", 7], 
           4 -> $CellContext`NonTerm["cond", 3], 
           17 -> $CellContext`Term["numOp", "Less"], 
           2 -> $CellContext`Term["logicOp", "Or"], 
           1 -> $CellContext`NonTerm["cond", 1], 
           19 -> $CellContext`NonTerm["numQuant", 5]}}]]}, 
      TagBox[GraphicsGroupBox[{
         {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
          ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGDgBmImKJ41a47yjKYb9rPB9A97BiiYA+a/sEeXnwUVxyX/
VldA4/Wk3/ZfirdKfUpkckDnQ+hPONU7HmzWsVv8D6c8xD4OB5g8unoYH9V9
CPUwPkweu3pEOKDLw9wBk0c3D8aHyQMAB0ihyw==
           "], 
           0.030695071075361624`]}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
          0.7]}], {
           DiskBox[{0.38297084310253526, 1.5318833724101413}, 
            0.030695071075361624], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], 
            Offset[{2, 2}, {0.4136659141778969, 1.5625784434855028}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 0.7659416862050707}, 0.030695071075361624], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"logicOp\"\>", ",", "\<\"Or\"\>"}], ")"}], 
            Offset[{2, 2}, {0.030695071075361624, 0.7966367572804324}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, 
          DiskBox[{0.7659416862050705, 0.7659416862050707}, 
           0.030695071075361624], {
           DiskBox[{1.7233687939614086, 2.297825058615212}, 
            0.030695071075361624], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {1.7540638650367701, 2.3285201296905735}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.148912529307606, 1.5318833724101413}, 
            0.030695071075361624], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {1.1796076003829676, 1.5625784434855028}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.9148542155126764, 1.5318833724101413}, 
            0.030695071075361624], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {1.945549286588038, 1.5625784434855028}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.063766744820282, 1.5318833724101413}, 
            0.030695071075361624], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {3.094461815895644, 1.5625784434855028}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.9148542155126764, 0.7659416862050707}, 
            0.030695071075361624], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
            Offset[{2, 2}, {1.945549286588038, 0.7966367572804324}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.531883372410141, 0.}, 0.030695071075361624], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"lag\"\>", ",", "2"}], ")"}], 
            Offset[{2, 2}, {1.5625784434855028, 0.030695071075361624}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.297825058615212, 0.}, 0.030695071075361624], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {2.3285201296905735, 0.030695071075361624}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.063766744820282, 0.7659416862050707}, 
            0.030695071075361624], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {3.094461815895644, 0.7966367572804324}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.063766744820282, 0.}, 0.030695071075361624], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
            Offset[{2, 2}, {3.094461815895644, 0.030695071075361624}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}}}],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    
    FormatType->TraditionalForm,
    FrameTicks->None,
    ImageSize->{420., Automatic}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "1"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"logicOp\"\>", ",", "\<\"Or\"\>"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"18", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"19", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"20", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "7"}], "]"}]}], ",", 
     RowBox[{"21", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"lag\"\>", ",", "2"}], "]"}]}], ",", 
     RowBox[{"22", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}], ",", 
     RowBox[{"23", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"24", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], "]"}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.790459173761779*^9, 3.790459197414949*^9}},
 CellLabel->
  "Out[269]=",ExpressionUUID->"5aa797e0-f93e-466a-936a-4348546f2e72"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"inserted", " ", "=", " ", 
  RowBox[{"InsertSubtree", "[", 
   RowBox[{
    RowBox[{"First", "[", "cropped2", "]"}], ",", 
    RowBox[{"Last", "[", "cropped2", "]"}], ",", 
    RowBox[{"First", "[", "subtree1", "]"}], ",", 
    RowBox[{"Last", "[", "subtree1", "]"}], ",", "3"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.790459291925201*^9, 3.790459348348867*^9}},
 CellLabel->
  "In[272]:=",ExpressionUUID->"c219c2b1-4841-4d3d-8cd3-e43e89d98e50"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 17, 18, 19, 20, 21, 22, 23, 24, 5, 6, 7, 8, 9, 10, 
        11}, {{{1, 2}, {1, 3}, {1, 4}, {4, 5}, {4, 6}, {4, 7}, {6, 8}, {8, 
         9}, {8, 10}, {7, 11}, {11, 12}, {3, 13}, {3, 14}, {3, 15}, {14, 
         16}, {16, 17}, {15, 18}, {18, 19}}, Null}, {
        VertexLabels -> {
          6 -> $CellContext`NonTerm["numQuant", 5], 
           21 -> $CellContext`Term["lag", 2], 
           18 -> $CellContext`NonTerm["numQuant", 5], 
           23 -> $CellContext`NonTerm["expression", 8], 
           24 -> $CellContext`Term["observable", "High"], 
           22 -> $CellContext`Term["observable", "Close"], 
           3 -> $CellContext`NonTerm["cond", 3], 
           20 -> $CellContext`NonTerm["expression", 7], 
           11 -> $CellContext`Term["observable", "Close"], 
           5 -> $CellContext`Term["numOp", "Less"], 
           8 -> $CellContext`NonTerm["expression", 8], 
           7 -> $CellContext`NonTerm["numQuant", 5], 
           10 -> $CellContext`NonTerm["expression", 8], 
           9 -> $CellContext`Term["observable", "Open"], 
           4 -> $CellContext`NonTerm["cond", 3], 
           17 -> $CellContext`Term["numOp", "Less"], 
           2 -> $CellContext`Term["logicOp", "Or"], 
           1 -> $CellContext`NonTerm["cond", 1], 
           19 -> $CellContext`NonTerm["numQuant", 5]}}]]}, 
      TagBox[GraphicsGroupBox[{
         {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
          ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGAQAmImKF6Qe/Zw974f9o+kW7+88WR3YICCV1eStxeWMzqg
y0Po5/a45CF8DgeYPLp6mPkQ8e/26PIwPn7573B5dPvQ1WF3DztOeZ1m6ReX
mATQ7GHH4D+AugtdPYz/AMUfCPVpFV9C1yewoIUDQj5+v+hkLWMuuDy6eTA+
qn7M8HqAVRxBo8qjq39ujx5P6ObB5AGsZR1f
           "], 0.03702325155936649]}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
          0.7]}], {
           DiskBox[{1.5465200089009628, 2.9110964873429888}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], 
            Offset[{2, 2}, {1.5835432604603292, 2.9481197389023555}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 2.183322365507242}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"logicOp\"\>", ",", "\<\"Or\"\>"}], ")"}], 
            Offset[{2, 2}, {0.03702325155936649, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.0930400178019255, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {3.130063269361292, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.183322365507242, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {2.2203456170666085, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.9110964873429888, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {2.9481197389023555, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.9110964873429888, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
            Offset[{2, 2}, {2.9481197389023555, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.5472094264251153, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"lag\"\>", ",", "2"}], ")"}], 
            Offset[{2, 2}, {2.584232677984482, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608627, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {3.3120067998202294, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 1.4555482436714944}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {0.03702325155936649, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.4555482436714944, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {1.4925714952308609, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.4555482436714944, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {1.4925714952308609, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.4555482436714944, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {1.4925714952308609, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}}}],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    
    FormatType->TraditionalForm,
    FrameTicks->None,
    ImageSize->{354., Automatic}], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "1"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"logicOp\"\>", ",", "\<\"Or\"\>"}], "]"}]}], ",", 
     RowBox[{"3", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"5", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"7", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"8", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"9", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], "]"}]}], ",", 
     RowBox[{"10", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"11", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}], ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"18", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"19", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"20", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "7"}], "]"}]}], ",", 
     RowBox[{"21", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"lag\"\>", ",", "2"}], "]"}]}], ",", 
     RowBox[{"22", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}], ",", 
     RowBox[{"23", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"24", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], "]"}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{3.790459318044755*^9, 3.790459348981124*^9},
 CellLabel->
  "Out[272]=",ExpressionUUID->"a85a055d-0e72-451f-954a-7b8f287a2e2a"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"SynthesizeTree", "[", 
   RowBox[{
    RowBox[{"First", "[", "inserted", "]"}], ",", 
    RowBox[{"Last", "[", "inserted", "]"}], ",", "grammar"}], "]"}], " ", "//",
   " ", "FullForm"}]], "Input",
 CellChangeTimes->{{3.7904593557805758`*^9, 3.790459367397191*^9}},
 CellLabel->
  "In[274]:=",ExpressionUUID->"14206010-6697-44a9-849b-cbff9c629a63"],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"Or", "[", 
    RowBox[{
     RowBox[{"Less", "[", 
      RowBox[{"Open", ",", "Close"}], "]"}], ",", 
     RowBox[{"Less", "[", 
      RowBox[{
       RowBox[{"Prev", "[", 
        RowBox[{"Close", ",", "2"}], "]"}], ",", "High"}], "]"}]}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellChangeTimes->{{3.790459361482438*^9, 3.790459367632287*^9}},
 CellLabel->
  "Out[274]//FullForm=",ExpressionUUID->"44cf0899-c74d-4217-ab1b-\
85566e06d191"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Crossover", "Section",
 CellChangeTimes->{{3.790459787904086*^9, 
  3.790459789280126*^9}},ExpressionUUID->"494e3a47-7a8e-4178-99aa-\
8aba6c8a5063"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"Crossover", "[", 
    RowBox[{"graph1_", ",", "labels1_", ",", "graph2_", ",", "labels2_"}], 
    "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "nonterms1", ",", "nonterms2", ",", "commonNonTerms", ",", "vertex1", 
       ",", "vertex2", ",", "cropped", ",", "sub"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"nonterms1", " ", "=", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{
         RowBox[{"labels1", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "_NonTerm"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nonterms2", " ", "=", " ", 
       RowBox[{"Cases", "[", 
        RowBox[{
         RowBox[{"labels2", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "_NonTerm"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"commonNonTerms", " ", "=", " ", 
       RowBox[{"Intersection", "[", 
        RowBox[{"nonterms1", ",", "nonterms2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"vertex1", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"RandomChoice", "[", 
         RowBox[{"Drop", "[", 
          RowBox[{
           RowBox[{"Position", "[", 
            RowBox[{
             RowBox[{"labels1", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
             RowBox[{"Apply", "[", 
              RowBox[{"Alternatives", ",", "commonNonTerms"}], "]"}]}], "]"}],
            ",", "1"}], "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vertex2", " ", "=", " ", 
       RowBox[{"First", "@", 
        RowBox[{"RandomChoice", "[", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{"labels2", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", 
           RowBox[{"Last", "[", 
            RowBox[{"labels1", "[", 
             RowBox[{"[", "vertex1", "]"}], "]"}], "]"}]}], "]"}], "]"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"cropped", " ", "=", " ", 
       RowBox[{"DeleteSubtree", "[", 
        RowBox[{"graph1", ",", "labels1", ",", "vertex1"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sub", " ", "=", " ", 
       RowBox[{"Subtree", "[", 
        RowBox[{"graph2", ",", "labels2", ",", "vertex2"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"InsertSubtree", "[", 
       RowBox[{
        RowBox[{"First", "[", "cropped", "]"}], ",", 
        RowBox[{"Last", "[", "cropped", "]"}], ",", 
        RowBox[{"First", "[", "sub", "]"}], ",", 
        RowBox[{"Last", "[", "sub", "]"}], ",", "vertex2"}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PopulationCrossover", "[", 
    RowBox[{"population_", ",", "childrenPerCouple_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "parts", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"parts", " ", "=", " ", 
       RowBox[{"Partition", "[", 
        RowBox[{
         RowBox[{"RandomSample", "[", "population", "]"}], ",", "2"}], 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Apply", "[", 
       RowBox[{"Join", ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"Map", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Apply", "[", 
              RowBox[{"Crossover", ",", 
               RowBox[{"Flatten", "[", 
                RowBox[{"#", ",", "1"}], "]"}]}], "]"}], "&"}], ",", 
            "parts"}], "]"}], ",", "childrenPerCouple"}], "]"}]}], "]"}]}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.790466749113225*^9, 3.790466810450017*^9}, {
   3.790466863810899*^9, 3.79046686402149*^9}, {3.7904669464720497`*^9, 
   3.7904669517101917`*^9}, 3.790467327295747*^9, {3.790467400399068*^9, 
   3.790467400859676*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"3adbcaa5-4ee8-47d8-95e8-cf3d90c2376b"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"crossoverTree", ",", "crossoverLabels"}], "}"}], " ", "=", " ", 
  RowBox[{"Crossover", "[", 
   RowBox[{"g1", ",", "labels1", ",", "g2", ",", "labels2"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.790466994204937*^9, 3.7904670029552517`*^9}},
 CellLabel->"In[89]:=",ExpressionUUID->"ed9c5530-1be9-42a3-8668-b5927b1ee27a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5, 6, 7, 8, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 
        9}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {3, 6}, {3, 7}, {6, 8}, {7, 
         9}, {9, 10}, {9, 11}, {4, 12}, {4, 13}, {4, 14}, {13, 15}, {15, 
         16}, {14, 17}, {17, 18}, {8, 19}}, Null}, {
        VertexLabels -> {
          6 -> $CellContext`NonTerm["numQuant", 5], 
           18 -> $CellContext`NonTerm["expression", 8], 
           3 -> $CellContext`NonTerm["cond", 3], 
           11 -> $CellContext`Term["lag", "3"], 
           5 -> $CellContext`Term["numOp", "Greater"], 
           8 -> $CellContext`NonTerm["expression", 8], 
           7 -> $CellContext`NonTerm["numQuant", 5], 
           14 -> $CellContext`NonTerm["numQuant", 5], 
           10 -> $CellContext`NonTerm["expression", 7], 
           9 -> $CellContext`Term["observable", "High"], 
           4 -> $CellContext`NonTerm["cond", 3], 
           17 -> $CellContext`Term["observable", "Open"], 
           16 -> $CellContext`NonTerm["expression", 8], 
           12 -> $CellContext`Term["observable", "Low"], 
           13 -> $CellContext`Term["numOp", "Less"], 
           2 -> $CellContext`Term["logicOp", "And"], 
           15 -> $CellContext`NonTerm["numQuant", 5], 
           1 -> $CellContext`NonTerm["cond", 1], 
           19 -> $CellContext`Term["observable", "Close"]}}]]}, 
      TagBox[GraphicsGroupBox[{
         {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
          ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGAQAmImKJYRjEs6ufy3/SPp1i9vPNkdIPRx+1dXkrcXljM6
oMvfSlpmmCHzFqd83H7RyVrGXA4weXT1DFAAUf/dHl0eIv7cHpf8bTD/L1we
3b60ii+h6xNYHHDJw/i45HWapV9cYhKAy6O7B8Z/AKXR3QPjP0DR9xyDDwsH
7Oq/45RHD0dc/oGpR/cPjA+TR1cP48PMR1cP48PkATCkB9M=
           "], 
           0.03702325155936649]}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
          0.7]}], {
           DiskBox[{1.7284635393598995, 2.9110964873429888}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], Offset[{2, 2}, 
            {1.765486790919266, 2.9481197389023555}], ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.1819435304589368, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"logicOp\"\>", ",", "\<\"And\"\>"}], ")"}], 
            Offset[{2, 2}, {0.21896678201830327, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.9097176522946839, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {0.9467409038540504, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 1.4555482436714944}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Greater\"\>"}], ")"}], 
            Offset[{2, 2}, {0.03702325155936649, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.819435304589368, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {1.8564585561487346, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.819435304589368, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
            Offset[{2, 2}, {1.8564585561487346, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.4555482436714944, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"lag\"\>", ",", "\<\"3\"\>"}], ")"}], 
            Offset[{2, 2}, {1.4925714952308609, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.183322365507242, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Low\"\>"}], ")"}], 
            Offset[{2, 2}, {2.2203456170666085, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.5472094264251153, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {2.584232677984482, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}}}],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "1"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"logicOp\"\>", ",", "\<\"And\"\>"}], "]"}]}], ",", 
     RowBox[{"3", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"5", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Greater\"\>"}], "]"}]}], ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"7", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"8", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"9", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], "]"}]}], ",", 
     RowBox[{"10", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "7"}], "]"}]}], ",", 
     RowBox[{"11", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"lag\"\>", ",", "\<\"3\"\>"}], "]"}]}], ",", 
     RowBox[{"12", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Low\"\>"}], "]"}]}], ",", 
     RowBox[{"13", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"14", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"15", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"16", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], "]"}]}], ",", 
     RowBox[{"18", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"19", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.790466992581543*^9, 3.7904670031818943`*^9}, {
  3.790467038969281*^9, 3.79046705629073*^9}, {3.790467330137656*^9, 
  3.790467372427169*^9}},
 CellLabel->"Out[89]=",ExpressionUUID->"1baf4ca9-5f59-40c1-853c-498506b4bcc9"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"SynthesizeTree", "[", 
   RowBox[{"crossoverTree", ",", "crossoverLabels", ",", "grammar"}], "]"}], "//",
   " ", "FullForm"}]], "Input",
 CellChangeTimes->{{3.7904668837630663`*^9, 3.790466892338079*^9}, {
  3.790466972237011*^9, 3.79046701970192*^9}},
 CellLabel->"In[90]:=",ExpressionUUID->"b419ca0e-3884-44b4-83f9-f19462c0db42"],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"And", "[", 
    RowBox[{
     RowBox[{"Greater", "[", 
      RowBox[{"High", ",", 
       RowBox[{"Prev", "[", 
        RowBox[{"Low", ",", "3"}], "]"}]}], "]"}], ",", 
     RowBox[{"Less", "[", 
      RowBox[{"Open", ",", "Close"}], "]"}]}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellChangeTimes->{
  3.790466893181904*^9, {3.790466953156445*^9, 3.790466982535943*^9}, {
   3.790467013072295*^9, 3.790467057159038*^9}, {3.7904673319765387`*^9, 
   3.790467373072021*^9}},
 CellLabel->
  "Out[90]//FullForm=",ExpressionUUID->"69301e0a-0367-4e1d-b7b5-0723e2344479"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Mutation", "Section",
 CellChangeTimes->{{3.790467419191723*^9, 
  3.790467421120267*^9}},ExpressionUUID->"2de844f5-b328-4128-981c-\
36589e6bf85d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"TreeMutation", "[", 
    RowBox[{"graph_", ",", "labels_"}], "]"}], ":=", 
   RowBox[{"Crossover", "[", 
    RowBox[{"graph", ",", "labels", ",", "graph", ",", "labels"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"TerminalMutation", "[", 
    RowBox[{"labels_", ",", "terminalSet_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"choice", ",", "type", ",", "newTerm"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"choice", " ", "=", " ", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{"Cases", "[", 
         RowBox[{"labels", ",", 
          RowBox[{"HoldPattern", "[", 
           RowBox[{"_", "\[Rule]", "_Term"}], "]"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"type", " ", "=", " ", 
       RowBox[{"First", "[", 
        RowBox[{"Level", "[", 
         RowBox[{
          RowBox[{"Last", "[", "choice", "]"}], ",", 
          RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"newTerm", " ", "=", " ", 
       RowBox[{"RandomChoice", "[", 
        RowBox[{"Complement", "[", 
         RowBox[{
          RowBox[{"Cases", "[", 
           RowBox[{"terminalSet", ",", 
            RowBox[{"Term", "[", 
             RowBox[{"type", ",", "_"}], "]"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"Last", "[", "choice", "]"}], "}"}]}], "]"}], "]"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ReplacePart", "[", 
       RowBox[{"labels", ",", 
        RowBox[{
         RowBox[{"First", "[", "choice", "]"}], "\[Rule]", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"First", "[", "choice", "]"}], "\[Rule]", "newTerm"}], 
          ")"}]}]}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Mutation", "[", 
    RowBox[{"graph_", ",", "labels_", ",", "terminalSet_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "mutatedSymbols", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"RandomReal", "[", "]"}], "\[GreaterEqual]", "0.5"}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"TreeMutation", "[", 
        RowBox[{"graph", ",", "labels"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"mutatedSymbols", " ", "=", " ", 
         RowBox[{"TerminalMutation", "[", 
          RowBox[{"labels", ",", "terminalSet"}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"Graph", "[", 
           RowBox[{
            RowBox[{"EdgeList", "[", "graph", "]"}], ",", 
            RowBox[{"VertexLabels", "\[Rule]", "mutatedSymbols"}]}], "]"}], 
          ",", "mutatedSymbols"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"PopulationMutate", "[", 
    RowBox[{
    "population_", ",", "probability_", ",", "terminalSet_", ",", 
     "functionSet_"}], "]"}], ":=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"RandomReal", "[", "]"}], "<", "probability"}], ",", 
        RowBox[{"Mutation", "[", 
         RowBox[{
          RowBox[{"First", "[", "#", "]"}], ",", 
          RowBox[{"Last", "[", "#", "]"}], ",", "terminalSet", ",", 
          "functionSet"}], "]"}], ",", "#"}], "]"}], "&"}], ",", 
     "population"}], "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.790467590078511*^9, 3.790467606299004*^9}, {
  3.790469761626421*^9, 3.790469834358567*^9}, {3.790469908034996*^9, 
  3.790469949268796*^9}, {3.790470046263938*^9, 3.7904700465336723`*^9}},
 CellLabel->"In[21]:=",ExpressionUUID->"312ef10a-a074-4597-b6a0-f711298c9fb9"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"mutatedTree", ",", "mutatedLabels"}], "}"}], " ", "=", " ", 
  RowBox[{"Mutation", "[", 
   RowBox[{"g1", ",", "labels1", ",", "terminalSet"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.790469988659707*^9, 3.79046999659832*^9}},
 CellLabel->
  "In[177]:=",ExpressionUUID->"a82a72d0-25c5-486e-8bea-974d20c28ac8"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 
        19}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {3, 6}, {3, 7}, {6, 8}, {8, 
         9}, {7, 10}, {10, 11}, {10, 12}, {4, 13}, {4, 14}, {4, 15}, {14, 
         16}, {16, 17}, {15, 18}, {18, 19}}, Null}, {
        VertexLabels -> {
          6 -> $CellContext`NonTerm["numQuant", 5], 
           18 -> $CellContext`NonTerm["expression", 8], 
           3 -> $CellContext`NonTerm["cond", 3], 
           11 -> $CellContext`Term["lag", "4"], 
           5 -> $CellContext`Term["numOp", "Greater"], 
           8 -> $CellContext`NonTerm["expression", 8], 
           7 -> $CellContext`NonTerm["numQuant", 5], 
           14 -> $CellContext`NonTerm["numQuant", 5], 
           10 -> $CellContext`NonTerm["expression", 7], 
           9 -> $CellContext`Term["observable", "High"], 
           4 -> $CellContext`NonTerm["cond", 3], 
           17 -> $CellContext`Term["observable", "Open"], 
           16 -> $CellContext`NonTerm["expression", 8], 
           12 -> $CellContext`Term["observable", "Low"], 
           13 -> $CellContext`Term["numOp", "Less"], 
           2 -> $CellContext`Term["logicOp", "And"], 
           15 -> $CellContext`NonTerm["numQuant", 5], 
           1 -> $CellContext`NonTerm["cond", 1], 
           19 -> $CellContext`Term["observable", "Close"]}}]]}, 
      TagBox[GraphicsGroupBox[{
         {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
          ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGAQAmImKJYRjEs6ufy3/SPp1i9vPNkdIPRx+1dXkrcXljM6
oMvfSlpmmCHzFqd83H7RyVrGXA4weXT1DFAAUf/dHl0eIv7cHpf8bTD/L1we
3b60ii+h6xNYHHDJw/i45HWapV9cYhKAy6O7B8Z/AKXR3QPjP0DR9xyDDwsH
7Oq/45RHD0dc/oGpR/cPjA+TR1cP48PMR1cP48PkATCkB9M=
           "], 
           0.03702325155936649]}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
          0.7]}], {
           DiskBox[{1.7284635393598995, 2.9110964873429888}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "1"}], ")"}], Offset[{2, 2}, 
            {1.765486790919266, 2.9481197389023555}], ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.1819435304589368, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"logicOp\"\>", ",", "\<\"And\"\>"}], ")"}], 
            Offset[{2, 2}, {0.21896678201830327, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.9097176522946839, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {0.9467409038540504, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 2.183322365507242}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 2.2203456170666085}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 1.4555482436714944}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Greater\"\>"}], ")"}], 
            Offset[{2, 2}, {0.03702325155936649, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.819435304589368, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {1.8564585561487346, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7277741218357472, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
            Offset[{2, 2}, {0.7647973733951137, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.819435304589368, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "7"}], ")"}], 
            Offset[{2, 2}, {1.8564585561487346, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.4555482436714944, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"lag\"\>", ",", "\<\"4\"\>"}], ")"}], 
            Offset[{2, 2}, {1.4925714952308609, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.183322365507242, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Low\"\>"}], ")"}], 
            Offset[{2, 2}, {2.2203456170666085, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.5472094264251153, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {2.584232677984482, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 1.4555482436714944}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "5"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 1.4925714952308609}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.2749835482608622, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], ")"}], 
            Offset[{2, 2}, {3.312006799820229, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 0.727774121835747}, 
            0.03702325155936649], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 0.7647973733951134}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{4.00275767009661, 0.}, 0.03702325155936649], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {4.039780921655977, 0.03702325155936649}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}}}],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "1"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"logicOp\"\>", ",", "\<\"And\"\>"}], "]"}]}], ",", 
     RowBox[{"3", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"5", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Greater\"\>"}], "]"}]}], ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"7", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"8", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"9", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], "]"}]}], ",", 
     RowBox[{"10", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "7"}], "]"}]}], ",", 
     RowBox[{"11", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"lag\"\>", ",", "\<\"4\"\>"}], "]"}]}], ",", 
     RowBox[{"12", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Low\"\>"}], "]"}]}], ",", 
     RowBox[{"13", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"14", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"15", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "5"}], "]"}]}], ",", 
     RowBox[{"16", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"17", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Open\"\>"}], "]"}]}], ",", 
     RowBox[{"18", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"19", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.790469986281681*^9, 3.790470011955103*^9}},
 CellLabel->
  "Out[177]=",ExpressionUUID->"2f29cb10-efad-4d8a-b628-20b254ba4d64"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"SynthesizeTree", "[", 
  RowBox[{"mutatedTree", ",", "mutatedLabels", ",", "grammar"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.7904699504560432`*^9, 3.790470001254924*^9}},
 CellLabel->
  "In[178]:=",ExpressionUUID->"f7e83c78-fc42-4a1a-befb-ab0149dc66dc"],

Cell[BoxData[
 RowBox[{
  RowBox[{"High", ">", 
   RowBox[{"Prev", "[", 
    RowBox[{"Low", ",", "4"}], "]"}]}], "&&", 
  RowBox[{"Open", "<", "Close"}]}]], "Output",
 CellChangeTimes->{{3.790469960586241*^9, 3.790470012539222*^9}},
 CellLabel->
  "Out[178]=",ExpressionUUID->"6349a885-0a94-4b14-82b9-00c7ad1675e0"]
}, Open  ]]
}, Closed]],

Cell["Fitness function", "Section",
 CellChangeTimes->{{3.790470072512094*^9, 
  3.790470076306596*^9}},ExpressionUUID->"dc03ccae-1210-4d2a-b9c5-\
1264261085e5"],

Cell[CellGroupData[{

Cell["Population initialization", "Section",
 CellChangeTimes->{{3.790470083277149*^9, 
  3.790470088442541*^9}},ExpressionUUID->"ba18f69f-6916-4ab5-9b7c-\
4291e64843c2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"NonTermName", "[", "nonterm_", "]"}], ":=", 
   RowBox[{"ReplaceAll", "[", 
    RowBox[{"nonterm", ",", 
     RowBox[{
      RowBox[{"NonTerm", "[", "x_", "]"}], "\[RuleDelayed]", "x"}]}], "]"}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"NonTermWithProd", "[", 
    RowBox[{"nonterm_", ",", "prodIndex_"}], "]"}], ":=", 
   RowBox[{"NonTerm", "[", 
    RowBox[{
     RowBox[{"NonTermName", "[", "nonterm", "]"}], ",", "prodIndex"}], 
    "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ApplicableProductions", "[", 
    RowBox[{"nonterm_", ",", "grammar_"}], "]"}], ":=", 
   RowBox[{"First", "@", 
    RowBox[{"Transpose", "@", 
     RowBox[{"Position", "[", 
      RowBox[{"grammar", ",", 
       RowBox[{"KeyValuePattern", "[", 
        RowBox[{"\"\<From\>\"", "\[Rule]", 
         RowBox[{"NonTermName", "[", "nonterm", "]"}]}], "]"}]}], "]"}]}]}]}],
   ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"UnassignedProductionQ", "[", "prod_", "]"}], ":=", 
    RowBox[{"MatchQ", "[", 
     RowBox[{"prod", ",", 
      RowBox[{"NonTerm", "[", "_", "]"}]}], "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ProductionRuleAsGraph", "[", 
     RowBox[{"grammar_", ",", "prodIndex_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "rootNonTerm", ",", "newLeafs", ",", "edgeList", ",", "vertexLabels"}],
        "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"rootNonTerm", " ", "=", " ", 
        RowBox[{"NonTermWithProd", "[", 
         RowBox[{
          RowBox[{"NonTerm", "[", 
           RowBox[{
            RowBox[{"grammar", "[", 
             RowBox[{"[", "prodIndex", "]"}], "]"}], "[", "\"\<From\>\"", 
            "]"}], "]"}], ",", "prodIndex"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"newLeafs", " ", "=", " ", 
        RowBox[{
         RowBox[{"grammar", "[", 
          RowBox[{"[", "prodIndex", "]"}], "]"}], "[", "\"\<To\>\"", "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"edgeList", " ", "=", " ", 
        RowBox[{"Thread", "[", 
         RowBox[{"1", "\[Rule]", 
          RowBox[{"Range", "[", 
           RowBox[{"2", ",", 
            RowBox[{"1", "+", 
             RowBox[{"Length", "[", "newLeafs", "]"}]}]}], "]"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"vertexLabels", " ", "=", " ", 
        RowBox[{"Prepend", "[", 
         RowBox[{
          RowBox[{"Thread", "[", 
           RowBox[{
            RowBox[{"Range", "[", 
             RowBox[{"2", ",", 
              RowBox[{"1", "+", 
               RowBox[{"Length", "[", "newLeafs", "]"}]}]}], "]"}], "\[Rule]",
             "newLeafs"}], "]"}], ",", 
          RowBox[{"1", "\[Rule]", "rootNonTerm"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"Graph", "[", 
          RowBox[{"edgeList", ",", 
           RowBox[{"VertexLabels", "\[Rule]", "vertexLabels"}]}], "]"}], ",", 
         "vertexLabels"}], "}"}]}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GrowTree", "[", 
     RowBox[{"graph_", ",", "labels_", ",", "grammar_"}], "]"}], ":=", 
    RowBox[{"Block", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "unassignedVertexes", ",", "replaceIndex", ",", "cropped", ",", 
        "replaceNonTerm", ",", "selectedProduction", ",", "sub"}], "}"}], ",",
       "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"unassignedVertexes", " ", "=", " ", 
        RowBox[{"Cases", "[", 
         RowBox[{"labels", ",", 
          RowBox[{
           RowBox[{"HoldPattern", "[", 
            RowBox[{"v_", "\[Rule]", 
             RowBox[{"t_", " ", "/;", " ", 
              RowBox[{"UnassignedProductionQ", "[", "t", "]"}]}]}], "]"}], 
           "\[RuleDelayed]", "v"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"replaceIndex", " ", "=", " ", 
        RowBox[{"RandomChoice", "[", "unassignedVertexes", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"cropped", " ", "=", " ", 
        RowBox[{"DeleteSubtree", "[", 
         RowBox[{"graph", ",", "labels", ",", "replaceIndex"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"replaceNonTerm", " ", "=", " ", 
        RowBox[{"Last", "[", 
         RowBox[{"labels", "[", 
          RowBox[{"[", "replaceIndex", "]"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"selectedProduction", " ", "=", " ", 
        RowBox[{"RandomChoice", "[", 
         RowBox[{"ApplicableProductions", "[", 
          RowBox[{"replaceNonTerm", ",", "grammar"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"sub", " ", "=", " ", 
        RowBox[{"ProductionRuleAsGraph", "[", 
         RowBox[{"grammar", ",", "selectedProduction"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"InsertSubtree", "[", 
        RowBox[{
         RowBox[{"First", "[", "cropped", "]"}], ",", 
         RowBox[{"Last", "[", "cropped", "]"}], ",", 
         RowBox[{"First", "[", "sub", "]"}], ",", 
         RowBox[{"Last", "[", "sub", "]"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateRandomTree", "[", "grammar_", "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", "tree", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"tree", " ", "=", 
       RowBox[{"ProductionRuleAsGraph", "[", 
        RowBox[{"grammar", ",", 
         RowBox[{"RandomInteger", "[", 
          RowBox[{"{", 
           RowBox[{"1", ",", "3"}], "}"}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"NestWhile", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"GrowTree", "[", 
          RowBox[{
           RowBox[{"First", "[", "#", "]"}], ",", 
           RowBox[{"Last", "[", "#", "]"}], ",", "grammar"}], "]"}], "&"}], 
        ",", "tree", ",", 
        RowBox[{
         RowBox[{"Apply", "[", 
          RowBox[{"Or", ",", 
           RowBox[{"Map", "[", 
            RowBox[{"UnassignedProductionQ", ",", 
             RowBox[{"Cases", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Last", "[", "#", "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "_NonTerm"}], 
              "]"}]}], "]"}]}], "]"}], "&"}]}], "\[IndentingNewLine]", 
       "]"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"RandomTerm", "[", 
    RowBox[{"name_", ",", "terminalSet_"}], "]"}], ":=", 
   RowBox[{"RandomChoice", "[", 
    RowBox[{"Cases", "[", 
     RowBox[{"terminalSet", ",", 
      RowBox[{"Term", "[", 
       RowBox[{"name", ",", "_"}], "]"}]}], "]"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"GenerateRandomTerminals", "[", 
     RowBox[{"labels_", ",", "terminalSet_"}], "]"}], ":=", 
    RowBox[{"ReplaceAll", "[", 
     RowBox[{"labels", ",", 
      RowBox[{
       RowBox[{"HoldPattern", "[", 
        RowBox[{"v_", "\[Rule]", 
         RowBox[{"Term", "[", "n_", "]"}]}], "]"}], "\[RuleDelayed]", 
       RowBox[{"(", 
        RowBox[{"v", "\[Rule]", 
         RowBox[{"RandomTerm", "[", 
          RowBox[{"n", ",", "terminalSet"}], "]"}]}], ")"}]}]}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"GenerateRandomFunction", "[", 
    RowBox[{"grammar_", ",", "terminalSet_"}], "]"}], ":=", 
   RowBox[{"Block", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"g", ",", "l", ",", "labelsWithTerminals"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"{", 
        RowBox[{"g", ",", "l"}], "}"}], " ", "=", " ", 
       RowBox[{"GenerateRandomTree", "[", "grammar", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"labelsWithTerminals", " ", "=", " ", 
       RowBox[{"GenerateRandomTerminals", "[", 
        RowBox[{"l", ",", "terminalSet"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"Graph", "[", 
         RowBox[{
          RowBox[{"EdgeList", "[", "g", "]"}], ",", 
          RowBox[{"VertexLabels", "\[Rule]", "labelsWithTerminals"}]}], "]"}],
         ",", "labelsWithTerminals"}], "}"}]}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.79054299450154*^9, 3.790543026260806*^9}, 
   3.790543230575636*^9, 3.7905432653671618`*^9, 3.790543306266807*^9, {
   3.7905434746614847`*^9, 3.790543475105719*^9}, {3.790544183363967*^9, 
   3.790544242331396*^9}, {3.790544926364554*^9, 3.790544980891444*^9}, 
   3.790545037348153*^9, {3.7905450692015657`*^9, 3.79054515508599*^9}},
 CellLabel->
  "In[109]:=",ExpressionUUID->"74feb33b-0d28-4497-82a7-826bf5115c1d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"{", 
   RowBox[{"g", ",", "l"}], "}"}], " ", "=", " ", 
  RowBox[{"GenerateRandomFunction", "[", 
   RowBox[{"grammar", ",", "terminalSet"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.790545429583273*^9, 3.790545433160524*^9}},
 CellLabel->
  "In[151]:=",ExpressionUUID->"e10f642c-c222-466b-b128-54e4041ea6eb"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{
   GraphicsBox[
    NamespaceBox["NetworkGraphics",
     DynamicModuleBox[{Typeset`graph = HoldComplete[
       Graph[{1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 
        12}, {{{1, 2}, {1, 3}, {1, 4}, {3, 5}, {3, 6}, {4, 7}, {4, 8}, {8, 
         9}, {8, 10}, {8, 11}, {6, 12}}, Null}, {
        VertexLabels -> {
          6 -> $CellContext`NonTerm["expression", 8], 
           3 -> $CellContext`NonTerm["numQuant", 4], 
           11 -> $CellContext`Term["window", "50"], 
           5 -> $CellContext`Term["factor", "1.3"], 
           8 -> $CellContext`NonTerm["expression", 6], 
           7 -> $CellContext`Term["factor", "1.1"], 
           10 -> $CellContext`Term["observable", "Close"], 
           9 -> $CellContext`Term["techInd", "EMA"], 
           4 -> $CellContext`NonTerm["numQuant", 4], 
           12 -> $CellContext`Term["observable", "High"], 
           2 -> $CellContext`Term["numOp", "Less"], 
           1 -> $CellContext`NonTerm["cond", 3]}}]]}, 
      TagBox[GraphicsGroupBox[{
         {Hue[0.6, 0.7, 0.5], Opacity[0.7], Arrowheads[Medium], 
          ArrowBox[CompressedData["
1:eJxTTMoPSmVmYGDgBmImKP5SvFXqU+InewjN5MAABbNnzVGe0fTDHl1+Flj8
hT0ueRgNk0dXD+HfsJ8DFcdlHkwe3TzHg806dov/4ZR3Z9eUdy1idUCVRzfv
kz3Mn+jqYebjkofxccm/1RXQeD2JGy4PANaql78=
           "], 0.03335973594133232]}, 
         {Hue[0.6, 0.2, 0.8], EdgeForm[{GrayLevel[0], Opacity[
          0.7]}], {
           DiskBox[{1.148912529307606, 2.297825058615212}, 
            0.03335973594133232], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"cond\"\>", ",", "3"}], ")"}], 
            Offset[{2, 2}, {1.1822722652489381, 2.331184794556544}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0., 1.5318833724101413}, 0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], ")"}], 
            Offset[{2, 2}, {0.03335973594133232, 1.5652431083514735}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.7659416862050705, 1.5318833724101413}, 
            0.03335973594133232], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "4"}], ")"}], 
            Offset[{2, 2}, {0.7993014221464029, 1.5652431083514735}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.297825058615212, 1.5318833724101413}, 
            0.03335973594133232], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"numQuant\"\>", ",", "4"}], ")"}], 
            Offset[{2, 2}, {2.331184794556544, 1.5652431083514735}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{0.38297084310253526, 0.7659416862050707}, 
            0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"factor\"\>", ",", "\<\"1.3\"\>"}], ")"}], 
            Offset[{2, 2}, {0.4163305790438676, 0.7993014221464031}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.148912529307606, 0.7659416862050707}, 
            0.03335973594133232], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "8"}], ")"}], 
            Offset[{2, 2}, {1.1822722652489381, 0.7993014221464031}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.9148542155126764, 0.7659416862050707}, 
            0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"factor\"\>", ",", "\<\"1.1\"\>"}], ")"}], 
            Offset[{2, 2}, {1.9482139514540087, 0.7993014221464031}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.680795901717747, 0.7659416862050707}, 
            0.03335973594133232], InsetBox[
            RowBox[{"NonTerm", "(", 
             RowBox[{"\<\"expression\"\>", ",", "6"}], ")"}], 
            Offset[{2, 2}, {2.714155637659079, 0.7993014221464031}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.9148542155126764, 0.}, 0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"techInd\"\>", ",", "\<\"EMA\"\>"}], ")"}], Offset[{2, 2},
             {1.9482139514540087, 0.03335973594133232}], ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{2.680795901717747, 0.}, 0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], ")"}], 
            Offset[{2, 2}, {2.714155637659079, 0.03335973594133232}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{3.4467375879228173, 0.}, 0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"window\"\>", ",", "\<\"50\"\>"}], ")"}], 
            Offset[{2, 2}, {3.4800973238641495, 0.03335973594133232}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}, {
           DiskBox[{1.148912529307606, 0.}, 0.03335973594133232], InsetBox[
            RowBox[{"Term", "(", 
             RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], ")"}], 
            Offset[{2, 2}, {1.1822722652489381, 0.03335973594133232}], 
            ImageScaled[{0, 0}],
            BaseStyle->"Graphics"]}}}],
       MouseAppearanceTag["NetworkGraphics"]],
      AllowKernelInitialization->False]],
    DefaultBaseStyle->{
     "NetworkGraphics", FrontEnd`GraphicsHighlightColor -> Hue[0.8, 1., 0.6]},
    
    FormatType->TraditionalForm,
    FrameTicks->None], ",", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"1", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"cond\"\>", ",", "3"}], "]"}]}], ",", 
     RowBox[{"2", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"numOp\"\>", ",", "\<\"Less\"\>"}], "]"}]}], ",", 
     RowBox[{"3", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "4"}], "]"}]}], ",", 
     RowBox[{"4", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"numQuant\"\>", ",", "4"}], "]"}]}], ",", 
     RowBox[{"5", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"factor\"\>", ",", "\<\"1.3\"\>"}], "]"}]}], ",", 
     RowBox[{"6", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "8"}], "]"}]}], ",", 
     RowBox[{"7", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"factor\"\>", ",", "\<\"1.1\"\>"}], "]"}]}], ",", 
     RowBox[{"8", "\[Rule]", 
      RowBox[{"NonTerm", "[", 
       RowBox[{"\<\"expression\"\>", ",", "6"}], "]"}]}], ",", 
     RowBox[{"9", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"techInd\"\>", ",", "\<\"EMA\"\>"}], "]"}]}], ",", 
     RowBox[{"10", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"Close\"\>"}], "]"}]}], ",", 
     RowBox[{"11", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"window\"\>", ",", "\<\"50\"\>"}], "]"}]}], ",", 
     RowBox[{"12", "\[Rule]", 
      RowBox[{"Term", "[", 
       RowBox[{"\<\"observable\"\>", ",", "\<\"High\"\>"}], "]"}]}]}], 
    "}"}]}], "}"}]], "Output",
 CellChangeTimes->{{3.790545423707356*^9, 3.790545439519074*^9}},
 CellLabel->
  "Out[151]=",ExpressionUUID->"b366a5af-bf83-4c58-95d4-6282117772fd"]
}, Open  ]],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{"SynthesizeTree", "[", 
   RowBox[{"g", ",", "l", ",", "grammar"}], "]"}], " ", "//", " ", 
  "FullForm"}]], "Input",
 CellLabel->
  "In[152]:=",ExpressionUUID->"083d2d44-6b70-4ebd-9563-a4f9ea356324"],

Cell[BoxData[
 TagBox[
  StyleBox[
   RowBox[{"Less", "[", 
    RowBox[{
     RowBox[{"Times", "[", 
      RowBox[{"1.3`", ",", "High"}], "]"}], ",", 
     RowBox[{"Times", "[", 
      RowBox[{"1.1`", ",", 
       RowBox[{"EMA", "[", 
        RowBox[{"Close", ",", "50"}], "]"}]}], "]"}]}], "]"}],
   ShowSpecialCharacters->False,
   ShowStringCharacters->True,
   NumberMarks->True],
  FullForm]], "Output",
 CellChangeTimes->{{3.790545427566152*^9, 3.790545440662861*^9}},
 CellLabel->
  "Out[152]//FullForm=",ExpressionUUID->"56f2dff4-df30-446f-bcfe-\
5a8cf20e1461"]
}, Open  ]]
}, Closed]],

Cell[CellGroupData[{

Cell["Selection", "Section",
 CellChangeTimes->{{3.7904700983986893`*^9, 
  3.790470099645873*^9}},ExpressionUUID->"b5eb2d33-a765-462a-a382-\
9a8f162fe893"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ProportionateSelectionIndexes", "[", 
     RowBox[{"population_", ",", "n_"}], "]"}], ":=", 
    RowBox[{"RandomSample", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Reverse", "[", 
        RowBox[{"Range", "[", "population", "]"}], "]"}], "->", 
       RowBox[{"Range", "[", "population", "]"}]}], ",", "n"}], "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"ProportionateRankedSelection", "[", 
    RowBox[{"evaluatedGenome_", ",", "n_"}], "]"}], ":=", " ", 
   RowBox[{"Part", "[", 
    RowBox[{
     RowBox[{"Reverse", "@", 
      RowBox[{"SortBy", "[", 
       RowBox[{"evaluatedGenome", ",", 
        RowBox[{"Key", "[", "\"\<Score\>\"", "]"}]}], "]"}]}], ",", 
     RowBox[{"ProportionateSelectionIndexes", "[", 
      RowBox[{
       RowBox[{"Length", "[", "evaluatedGenome", "]"}], ",", "n"}], "]"}]}], 
    "]"}]}], ";"}]}], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.784324415464973*^9, 3.7843244870640163`*^9}, {
   3.784324545012617*^9, 3.784324551407508*^9}, {3.784324689942568*^9, 
   3.7843246996464663`*^9}, {3.784383338439673*^9, 3.784383384580194*^9}, {
   3.7843835319289513`*^9, 3.784383537583535*^9}, {3.784383627136422*^9, 
   3.784383680007265*^9}, {3.7843837903725348`*^9, 3.7843838591169033`*^9}, {
   3.784383899108395*^9, 3.7843839193211737`*^9}, {3.784495117366159*^9, 
   3.7844951235361853`*^9}, {3.7847373781884937`*^9, 3.784737378482913*^9}, {
   3.789935842735297*^9, 3.789935846517482*^9}, {3.789947735540329*^9, 
   3.789947737415945*^9}, 3.7904701213589487`*^9},
 CellLabel->"In[32]:=",ExpressionUUID->"2e167ae8-e18f-45c6-bf61-bdd497c5b695"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Main algorithm", "Section",
 CellChangeTimes->{{3.790470132244419*^9, 
  3.790470134476201*^9}},ExpressionUUID->"021b0e13-2bbb-4b09-8d76-\
618b4b133104"],

Cell[BoxData[
 RowBox[{"Needs", "[", 
  RowBox[{"\"\<AdvancedMapping`\>\"", ",", 
   RowBox[{"FileNameJoin", "[", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"NotebookDirectory", "[", "]"}], ",", "\"\<Extra\>\"", ",", 
      "\"\<AdvancedMapping.wl\>\""}], "}"}], "]"}]}], "]"}]], "Input",
 InitializationCell->True,
 CellChangeTimes->{{3.789947495697592*^9, 3.789947495865506*^9}, 
   3.789947574981628*^9},
 CellLabel->"In[34]:=",ExpressionUUID->"099029d1-14bb-41cb-80c0-f8ea8280aa9f"]
}, Open  ]]
}, Open  ]]
},
WindowSize->{932, 1013},
WindowMargins->{{58, Automatic}, {0, Automatic}},
FrontEndVersion->"12.0 for Linux x86 (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[422, 15, 176, 3, 99, "Title",ExpressionUUID->"231a28b8-24e8-4850-bed2-97e28e2feb38"],
Cell[CellGroupData[{
Cell[623, 22, 177, 3, 68, "Section",ExpressionUUID->"082e424d-3c6e-4a29-ab66-8f49caa9d4f7"],
Cell[803, 27, 11066, 260, 853, "Input",ExpressionUUID->"2596c319-046c-4a6c-a461-990c8cd0bff1",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[11894, 291, 201, 4, 31, "Input",ExpressionUUID->"effdc811-5ed1-4747-a52b-de866aec4d5c"],
Cell[12098, 297, 3324, 114, 163, "Output",ExpressionUUID->"e39b8d9b-d591-4ff2-9df0-992f6f1ae4b5"]
}, Open  ]],
Cell[15437, 414, 2375, 58, 232, "Input",ExpressionUUID->"dbcee70f-0ecd-408e-9a7c-2a6b3a243902",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[17837, 476, 196, 4, 31, "Input",ExpressionUUID->"407eac81-0c5d-4ce8-a328-cbba96d15565"],
Cell[18036, 482, 5594, 107, 468, "Output",ExpressionUUID->"a30814f3-ec89-4bc8-a2d6-a1df53b63b0c"]
}, Open  ]],
Cell[23645, 592, 6875, 170, 784, "Input",ExpressionUUID->"48a50991-ced2-49a9-8324-4b430a7ed712",
 InitializationCell->True],
Cell[30523, 764, 5028, 114, 508, "Input",ExpressionUUID->"eb1b2b68-d657-4bb4-87c4-41912d2b4be6",
 InitializationCell->True],
Cell[35554, 880, 4035, 83, 485, "Input",ExpressionUUID->"7ab65703-bb69-4f34-8664-807662f2a19e",
 InitializationCell->True],
Cell[39592, 965, 4134, 94, 216, "Input",ExpressionUUID->"d422a228-1249-4f3c-9929-cb45137abfd3"],
Cell[CellGroupData[{
Cell[43751, 1063, 419, 9, 31, "Input",ExpressionUUID->"1398a73c-95e3-40e9-bd35-e307cdab8d23"],
Cell[44173, 1074, 8830, 180, 499, "Output",ExpressionUUID->"02f03ab0-2c6d-4af0-af08-a1264c6c3284"]
}, Open  ]],
Cell[CellGroupData[{
Cell[53040, 1259, 307, 7, 31, "Input",ExpressionUUID->"32448206-7dfc-4813-9eed-06133cc5405a"],
Cell[53350, 1268, 834, 23, 50, "Output",ExpressionUUID->"a642a942-e8cd-4e4a-b0fb-b73e76872ceb"]
}, Open  ]],
Cell[54199, 1294, 4937, 113, 262, "Input",ExpressionUUID->"b4317d5f-dfa0-4326-a688-fb99011c98a0"],
Cell[CellGroupData[{
Cell[59161, 1411, 374, 8, 31, "Input",ExpressionUUID->"6921fcbe-378e-4bd9-9c4c-cdbbf2a392dc"],
Cell[59538, 1421, 10521, 212, 266, "Output",ExpressionUUID->"f0d87c59-723c-4b4f-b403-4a4c2bf7a89c"]
}, Open  ]],
Cell[CellGroupData[{
Cell[70096, 1638, 304, 7, 31, "Input",ExpressionUUID->"888fe5d3-d03d-481c-9fb7-de8fab3b9e8a"],
Cell[70403, 1647, 871, 26, 50, "Output",ExpressionUUID->"66df493e-7ed9-41f0-8d00-f1468e8e8034"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[71323, 1679, 166, 3, 68, "Section",ExpressionUUID->"b7490d6f-4c75-440d-9324-b62f58f03dc2"],
Cell[71492, 1684, 10538, 251, 1152, "Input",ExpressionUUID->"f631ef19-1d41-4fd9-be26-8ef5eea1ab3f",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[82055, 1939, 177, 3, 31, "Input",ExpressionUUID->"5d759315-b71a-4268-8979-a61ce94b5f9c"],
Cell[82235, 1944, 8511, 175, 315, "Output",ExpressionUUID->"754537b9-7461-4c38-a93f-6e86f7120fe0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[90783, 2124, 292, 6, 31, "Input",ExpressionUUID->"5e2c98fc-7eaa-4ff9-b894-346660be4288"],
Cell[91078, 2132, 5873, 121, 441, "Output",ExpressionUUID->"59736a14-0078-4d81-acf8-1fdcc2fd6ca0"]
}, Open  ]],
Cell[CellGroupData[{
Cell[96988, 2258, 296, 6, 31, "Input",ExpressionUUID->"890deaf9-277f-4132-b2d7-551af28a4f02"],
Cell[97287, 2266, 7151, 154, 367, "Output",ExpressionUUID->"5aa797e0-f93e-466a-936a-4348546f2e72"]
}, Open  ]],
Cell[CellGroupData[{
Cell[104475, 2425, 471, 10, 31, "Input",ExpressionUUID->"c219c2b1-4841-4d3d-8cd3-e43e89d98e50"],
Cell[104949, 2437, 11286, 236, 358, "Output",ExpressionUUID->"a85a055d-0e72-451f-954a-7b8f287a2e2a"]
}, Open  ]],
Cell[CellGroupData[{
Cell[116272, 2678, 383, 9, 31, "Input",ExpressionUUID->"14206010-6697-44a9-849b-cbff9c629a63"],
Cell[116658, 2689, 566, 18, 50, "Output",ExpressionUUID->"44cf0899-c74d-4217-ab1b-85566e06d191"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[117273, 2713, 154, 3, 54, "Section",ExpressionUUID->"494e3a47-7a8e-4178-99aa-8aba6c8a5063"],
Cell[117430, 2718, 4184, 103, 462, "Input",ExpressionUUID->"3adbcaa5-4ee8-47d8-95e8-cf3d90c2376b",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[121639, 2825, 377, 8, 31, "Input",ExpressionUUID->"ed9c5530-1be9-42a3-8668-b5927b1ee27a"],
Cell[122019, 2835, 11406, 237, 193, "Output",ExpressionUUID->"1baf4ca9-5f59-40c1-853c-498506b4bcc9"]
}, Open  ]],
Cell[CellGroupData[{
Cell[133462, 3077, 367, 7, 31, "Input",ExpressionUUID->"b419ca0e-3884-44b4-83f9-f19462c0db42"],
Cell[133832, 3086, 692, 20, 50, "Output",ExpressionUUID->"69301e0a-0367-4e1d-b7b5-0723e2344479"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[134573, 3112, 153, 3, 54, "Section",ExpressionUUID->"2de844f5-b328-4128-981c-36589e6bf85d"],
Cell[134729, 3117, 3967, 102, 439, "Input",ExpressionUUID->"312ef10a-a074-4597-b6a0-f711298c9fb9",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[138721, 3223, 362, 8, 31, "Input",ExpressionUUID->"a82a72d0-25c5-486e-8bea-974d20c28ac8"],
Cell[139086, 3233, 11313, 236, 193, "Output",ExpressionUUID->"2f29cb10-efad-4d8a-b628-20b254ba4d64"]
}, Open  ]],
Cell[CellGroupData[{
Cell[150436, 3474, 282, 6, 31, "Input",ExpressionUUID->"f7e83c78-fc42-4a1a-befb-ab0149dc66dc"],
Cell[150721, 3482, 315, 8, 35, "Output",ExpressionUUID->"6349a885-0a94-4b14-82b9-00c7ad1675e0"]
}, Open  ]]
}, Closed]],
Cell[151063, 3494, 161, 3, 54, "Section",ExpressionUUID->"dc03ccae-1210-4d2a-b9c5-1264261085e5"],
Cell[CellGroupData[{
Cell[151249, 3501, 170, 3, 54, "Section",ExpressionUUID->"ba18f69f-6916-4ab5-9b7c-4291e64843c2"],
Cell[151422, 3506, 9232, 237, 1060, "Input",ExpressionUUID->"74feb33b-0d28-4497-82a7-826bf5115c1d",
 InitializationCell->True],
Cell[CellGroupData[{
Cell[160679, 3747, 344, 8, 31, "Input",ExpressionUUID->"e10f642c-c222-466b-b128-54e4041ea6eb"],
Cell[161026, 3757, 7464, 157, 152, "Output",ExpressionUUID->"b366a5af-bf83-4c58-95d4-6282117772fd"]
}, Open  ]],
Cell[CellGroupData[{
Cell[168527, 3919, 234, 6, 31, "Input",ExpressionUUID->"083d2d44-6b70-4ebd-9563-a4f9ea356324"],
Cell[168764, 3927, 569, 18, 83, "Output",ExpressionUUID->"56f2dff4-df30-446f-bcfe-5a8cf20e1461"]
}, Open  ]]
}, Closed]],
Cell[CellGroupData[{
Cell[169382, 3951, 156, 3, 54, "Section",ExpressionUUID->"b5eb2d33-a765-462a-a382-9a8f162fe893"],
Cell[169541, 3956, 1713, 37, 163, "Input",ExpressionUUID->"2e167ae8-e18f-45c6-bf61-bdd497c5b695",
 InitializationCell->True]
}, Open  ]],
Cell[CellGroupData[{
Cell[171291, 3998, 159, 3, 68, "Section",ExpressionUUID->"021b0e13-2bbb-4b09-8d76-618b4b133104"],
Cell[171453, 4003, 490, 11, 50, "Input",ExpressionUUID->"099029d1-14bb-41cb-80c0-f8ea8280aa9f",
 InitializationCell->True]
}, Open  ]]
}, Open  ]]
}
]
*)

